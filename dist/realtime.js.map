{"version":3,"file":null,"sources":["/home/travis/build/leancloud/js-realtime-sdk/src/utils/expirable.js","/home/travis/build/leancloud/js-realtime-sdk/src/utils/cache.js","/home/travis/build/leancloud/js-realtime-sdk/src/utils/index.js","/home/travis/build/leancloud/js-realtime-sdk/src/websocket-plus.js","/home/travis/build/leancloud/js-realtime-sdk/src/error.js","/home/travis/build/leancloud/js-realtime-sdk/proto/message-compiled.js","/home/travis/build/leancloud/js-realtime-sdk/proto/message.js","/home/travis/build/leancloud/js-realtime-sdk/src/connection.js","/home/travis/build/leancloud/js-realtime-sdk/src/plugin.js","/home/travis/build/leancloud/js-realtime-sdk/src/client.js","/home/travis/build/leancloud/js-realtime-sdk/src/conversation-query.js","/home/travis/build/leancloud/js-realtime-sdk/src/signature-factory-runner.js","/home/travis/build/leancloud/js-realtime-sdk/src/messages/message.js","/home/travis/build/leancloud/js-realtime-sdk/src/im-client.js","/home/travis/build/leancloud/js-realtime-sdk/src/conversation.js","/home/travis/build/leancloud/js-realtime-sdk/src/message-parser.js","/home/travis/build/leancloud/js-realtime-sdk/src/messages/helpers.js","/home/travis/build/leancloud/js-realtime-sdk/src/messages/typed-message.js","/home/travis/build/leancloud/js-realtime-sdk/src/messages/text-message.js","/home/travis/build/leancloud/js-realtime-sdk/src/realtime.js","/home/travis/build/leancloud/js-realtime-sdk/src/index.js"],"sourcesContent":["import { default as d } from 'debug';\n\nconst EXPIRED = Symbol('expired');\nconst debug = d('LC:Expirable');\nexport default class Expirable {\n  constructor(value, ttl) {\n    this._value = value;\n    if (typeof ttl === 'number') {\n      this.expiredAt = Date.now() + ttl;\n    }\n  }\n\n  get value() {\n    const expired = this.expiredAt && this.expiredAt < Date.now();\n    if (expired) debug(`expired: ${this._value}`);\n    return expired ? EXPIRED : this._value;\n  }\n}\nExpirable.EXPIRED = EXPIRED;\n","import { default as d } from 'debug';\nimport Expirable from './expirable';\n\nconst debug = d('LC:Cache');\nexport default class Cache {\n  constructor(name = 'anonymous') {\n    this.name = name;\n    this._map = {};\n  }\n\n  get(key) {\n    const cache = this._map[key];\n    if (cache) {\n      const value = cache.value;\n      if (value !== Expirable.EXPIRED) {\n        debug(`[${this.name}] hit: ${key} ${cache.value}`);\n        return cache.value;\n      }\n      delete this._map[key];\n    }\n    debug(`[${this.name}] missed: ${key}`);\n    return null;\n  }\n\n  set(key, value, ttl) {\n    debug(`[${this.name}] set: ${key} ${value} ${ttl}`);\n    this._map[key] = new Expirable(value, ttl);\n  }\n}\n","import isPlainObject from 'lodash/isPlainObject';\n\nexport const tryAll = (promiseConstructors) => {\n  const promise = new Promise(promiseConstructors[0]);\n  if (promiseConstructors.length === 1) {\n    return promise;\n  }\n  return promise.catch(() => tryAll(promiseConstructors.slice(1)));\n};\n\nexport const tap = interceptor => value => ((interceptor(value), value));\n\nexport { default as Expirable } from './expirable';\nexport { default as Cache } from './cache';\n\nexport const decodeDate = (date) => {\n  if (!date) return date;\n  if (typeof date === 'string') {\n    return new Date(date);\n  }\n  if (date.__type === 'Date' && date.iso) {\n    return new Date(date.iso);\n  }\n  return date;\n};\n\nexport const keyRemap = (keymap, obj) =>\n  Object.keys(obj).reduce((newObj, key) => {\n    const newKey = keymap[key] || key;\n    return Object.assign(newObj, {\n      [newKey]: obj[key],\n    });\n  }, {});\n\nexport const isIE10 = (\n  global.navigator &&\n  global.navigator.userAgent &&\n  global.navigator.userAgent.indexOf('MSIE 10.') !== -1\n);\n\n/* eslint-disable no-proto */\nexport const getStaticProperty = (klass, property) =>\n  (klass[property] || (klass.__proto__ ? getStaticProperty(klass.__proto__, property) : undefined));\n/* eslint-enable no-proto */\n\nexport const union = (a, b) => Array.from(new Set([...a, ...b]));\nexport const difference = (a, b) => Array.from(\n  (bSet => new Set(a.filter(x => !bSet.has(x))))(new Set(b))\n);\n\nconst map = new WeakMap();\n\n// protected property helper\nexport const internal = (object) => {\n  if (!map.has(object)) {\n    map.set(object, {});\n  }\n  return map.get(object);\n};\n\n// debug utility\nconst removeNull = (obj) => {\n  if (!isPlainObject(obj)) return obj;\n  const object = Object.assign({}, obj);\n  // eslint-disable-next-line no-restricted-syntax\n  for (const prop in object) {\n    if ({}.hasOwnProperty.call(object, prop)) {\n      const value = object[prop];\n      if (value === null) {\n        delete object[prop];\n      } else {\n        object[prop] = removeNull(value);\n      }\n    }\n  }\n  return object;\n};\nexport const trim = message => removeNull(JSON.parse(JSON.stringify(message)));\n\nexport const ensureArray = (target) => {\n  if (Array.isArray(target)) {\n    return target;\n  }\n  if (target === undefined || target === null) {\n    return [];\n  }\n  return [target];\n};\n\nexport const setValue = (target, key, value) => {\n  // '.' is not allowed in Class keys, escaping is not in concern now.\n  const segs = key.split('.');\n  const lastSeg = segs.pop();\n  let currentTarget = target;\n  segs.forEach((seg) => {\n    if (currentTarget[seg] === undefined) currentTarget[seg] = {};\n    currentTarget = currentTarget[seg];\n  });\n  currentTarget[lastSeg] = value;\n  return target;\n};\n","// WebSocket with auto reconnecting feature, backup endpoint and EventEmitter interface.\n\nimport { default as d } from 'debug';\nimport EventEmitter from 'eventemitter3';\nimport StateMachine from 'javascript-state-machine';\n\nimport WebSocket from 'ws';\n\nimport { tryAll } from './utils';\n\nconst debug = d('LC:WebSocketPlus');\n\nconst HEARTBEAT_TIME = 60000;\nconst TIMEOUT_TIME = 180000;\n\nconst DEFAULT_RETRY_STRATEGY = attempt => Math.min(1000 * Math.pow(2, attempt), 300000);\n\nconst requireConnected = (target, name, descriptor) =>\n  Object.assign({}, descriptor, {\n    value: function requireConnectedWrapper(...args) {\n      if (!this.is('connected')) {\n        const currentState = this.current;\n        console.warn(`${name} should not be called when the connection is ${currentState}`);\n        if (this.is('offline') || this.is('reconnecting')) {\n          console.warn('disconnect and reconnect event should be handled to avoid such calls.');\n        }\n        throw new Error('Connection unavailable');\n      }\n      return descriptor.value.call(this, ...args);\n    },\n  });\n\nclass WebSocketPlus extends EventEmitter {\n  constructor(getUrls, protocol) {\n    debug('initializing WebSocketPlus');\n    if (typeof WebSocket === 'undefined') {\n      throw new Error('WebSocket is undefined. Polyfill is required in this runtime.');\n    }\n    super();\n    if (typeof getUrls !== 'function') {\n      this._getUrls = () => Promise.resolve(getUrls);\n    } else {\n      this._getUrls = getUrls;\n    }\n    this._protocol = protocol;\n    this.init();\n    this._createWs(this._getUrls, this._protocol).then(\n      () => this.open(),\n      error => this.throw(error)\n    ).catch(this.throw.bind(this));\n    this.__postponeTimers = this._postponeTimers.bind(this);\n  }\n\n  _createWs(getUrls, protocol) {\n    return getUrls().then((wsUrls) => {\n      let urls = wsUrls;\n      if (!(urls instanceof Array)) {\n        urls = [urls];\n      }\n      return tryAll(\n        urls.map(url => (resolve, reject) => {\n          debug(`connect [${url}] ${protocol}`);\n          const ws = protocol ? new WebSocket(\n            url, protocol\n          ) : new WebSocket(url);\n          ws.binaryType = this.binaryType || 'arraybuffer';\n          ws.onopen = () => resolve(ws);\n          ws.onerror = ws.onclose = (error) => {\n            if (error instanceof Error) {\n              return reject(error);\n            }\n            // in browser, error event is useless\n            return reject(new Error(`Failed to connect [${url}]`));\n          };\n        })\n      ).then((ws) => {\n        this._ws = ws;\n        this._ws.onclose = this._handleClose.bind(this);\n        this._ws.onmessage = this._handleMessage.bind(this);\n        return ws;\n      });\n    });\n  }\n  _destroyWs() {\n    const ws = this._ws;\n    if (!ws) return;\n    ws.onopen = ws.onclose = ws.onerror = ws.onmessage = null;\n    this._ws = null;\n    ws.close();\n  }\n\n  onopen() {\n    debug('open');\n    this.emit('open');\n  }\n  onconnected() {\n    this._startConnectionKeeper();\n  }\n  onleaveconnected() {\n    this._stopConnectionKeeper();\n  }\n  onbeforedisconnect() {\n    debug('disconnect');\n    this.emit('disconnect');\n  }\n  ondisconnect() {\n    this._destroyWs();\n  }\n  onreconnect() {\n    debug('reconnect');\n    this.emit('reconnect');\n  }\n  onoffline(event, from, to, attempt = 0) {\n    const delay = DEFAULT_RETRY_STRATEGY.call(null, attempt);\n    debug(`schedule attempt=${attempt} delay=${delay}`);\n    this.emit('schedule', attempt, delay);\n    if (this.__scheduledRetry) {\n      clearTimeout(this.__scheduledRetry);\n    }\n    this.__scheduledRetry = setTimeout(() => {\n      if (this.is('offline')) {\n        this.retry(attempt);\n      }\n    }, delay);\n  }\n  onretry(event, from, to, attempt = 0) {\n    debug(`retry attempt=${attempt}`);\n    this.emit('retry', attempt);\n    this._createWs(this._getUrls, this._protocol).then(\n      () => this.reconnect(),\n      () => this.fail(attempt + 1)\n    );\n  }\n  onclose() {\n    debug('close');\n    if (this._ws) {\n      this._ws.close();\n    }\n  }\n  onerror(event, from, to, error) {\n    debug('error', error);\n    this.emit('error', error);\n  }\n\n  // jsdoc-ignore-start\n  @requireConnected\n  // jsdoc-ignore-end\n  _ping() {\n    debug('ping');\n    try {\n      this.ping();\n    } catch (error) {\n      console.warn(`websocket ping error: ${error.message}`);\n    }\n  }\n  ping() {\n    if (this._ws.ping) {\n      this._ws.ping();\n    } else {\n      console.warn(`The WebSocket implement does not support sending ping frame.\n        Override ping method to use application defined ping/pong mechanism.`);\n    }\n  }\n\n  _postponeTimers() {\n    debug('_postponeTimers');\n    this._clearTimers();\n    this._heartbeatTimer = setInterval(this._ping.bind(this), HEARTBEAT_TIME);\n    this._timeoutTimer = setTimeout(() => {\n      debug('timeout');\n      this.disconnect();\n    }, TIMEOUT_TIME);\n  }\n  _clearTimers() {\n    if (this._heartbeatTimer) {\n      clearInterval(this._heartbeatTimer);\n    }\n    if (this._timeoutTimer) {\n      clearTimeout(this._timeoutTimer);\n    }\n  }\n  _startConnectionKeeper() {\n    debug('start connection keeper');\n    const addListener = this._ws.addListener || this._ws.addEventListener;\n    addListener.call(this._ws, 'message', this.__postponeTimers);\n    this._postponeTimers();\n  }\n  _stopConnectionKeeper() {\n    debug('stop connection keeper');\n    // websockets/ws#489\n    const removeListener = this._ws.removeListener || this._ws.removeEventListener;\n    removeListener.call(this._ws, 'message', this.__postponeTimers);\n    this._clearTimers();\n  }\n\n  _handleClose(event) {\n    debug(`ws closed [${event.code}] ${event.reason}`);\n    // socket closed manually, ignore close event.\n    if (this.isFinished()) return;\n    this.handleClose(event);\n  }\n  handleClose() {\n    // reconnect\n    this.disconnect();\n  }\n\n  // jsdoc-ignore-start\n  @requireConnected\n  // jsdoc-ignore-end\n  send(data) {\n    debug('send', data);\n    this._ws.send(data);\n  }\n\n  _handleMessage(event) {\n    debug('message', event.data);\n    this.handleMessage(event.data);\n  }\n  handleMessage(message) {\n    this.emit('message', message);\n  }\n}\n\nStateMachine.create({\n  target: WebSocketPlus.prototype,\n  initial: {\n    state: 'initialized',\n    event: 'init',\n    defer: true,\n  },\n  terminal: 'closed',\n  events: [{\n    name: 'open',\n    from: 'initialized',\n    to: 'connected',\n  }, {\n    name: 'disconnect',\n    from: 'connected',\n    to: 'offline',\n  }, {\n    name: 'retry',\n    from: 'offline',\n    to: 'reconnecting',\n  }, {\n    name: 'fail',\n    from: 'reconnecting',\n    to: 'offline',\n  }, {\n    name: 'reconnect',\n    from: 'reconnecting',\n    to: 'connected',\n  }, {\n    name: 'close',\n    from: ['connected', 'offline', 'reconnecting'],\n    to: 'closed',\n  }, {\n    name: 'throw',\n    from: '*',\n    to: 'error',\n  }],\n});\n\nexport default WebSocketPlus;\n","export const error = {\n  1000: {\n    name: 'CLOSE_NORMAL',\n  },\n  1006: {\n    name: 'CLOSE_ABNORMAL',\n  },\n  4100: {\n    name: 'APP_NOT_AVAILABLE',\n    message: 'App not exists or realtime message service is disabled.',\n  },\n  4103: {\n    name: 'INVALID_LOGIN',\n    message: 'Malformed clientId.',\n  },\n  4105: {\n    name: 'SESSION_REQUIRED',\n    message: 'Message sent before session opened. ',\n  },\n  4107: {\n    name: 'READ_TIMEOUT',\n  },\n  4108: {\n    name: 'LOGIN_TIMEOUT',\n  },\n  4109: {\n    name: 'FRAME_TOO_LONG',\n  },\n  4110: {\n    name: 'INVALID_ORIGIN',\n    message: 'Access denied by domain whitelist.',\n  },\n  4111: {\n    name: 'SESSION_CONFLICT',\n  },\n  4112: {\n    name: 'SESSION_TOKEN_EXPIRED',\n  },\n  4200: {\n    name: 'INTERNAL_ERROR',\n    message: 'Internal error, please contact LeanCloud for support.',\n  },\n  4201: {\n    name: 'SEND_MESSAGE_TIMEOUT',\n  },\n  4302: {\n    name: 'CONVERSATION_SIGNATURE_FAILED',\n  },\n  4303: {\n    name: 'CONVERSATION_NOT_FOUND',\n  },\n  4304: {\n    name: 'CONVERSATION_FULL',\n  },\n  4305: {\n    name: 'CONVERSATION_REJECTED_BY_APP',\n  },\n  4306: {\n    name: 'CONVERSATION_UPDATE_FAILED',\n  },\n  4307: {\n    name: 'CONVERSATION_READ_ONLY',\n  },\n  4308: {\n    name: 'CONVERSATION_NOT_ALLOWED',\n  },\n  4401: {\n    name: 'INVALID_MESSAGING_TARGET',\n  },\n  4402: {\n    name: 'MESSAGE_REJECTED_BY_APP',\n  },\n};\n\nexport const ErrorCode = Object\n  .keys(error)\n  .reduce((result, code) => Object.assign(result, {\n    [error[code].name]: Number(code),\n  }), {});\n\nexport const createError = (errorMessage) => {\n  const {\n    code, reason, appCode, detail,\n  } = errorMessage;\n  let message = reason || detail;\n  if (!message && error[code]) {\n    message = error[code].message || error[code].name;\n  }\n  if (!message) {\n    message = `Unknow Error: ${code}`;\n  }\n  const err = new Error(message);\n  return Object.assign(err, {\n    code, appCode, detail,\n  });\n};\n","module.exports = require(\"protobufjs/dist/protobuf-light\").newBuilder({})['import']({\n    \"package\": \"push_server.messages\",\n    \"options\": {\n        \"objc_class_prefix\": \"AVIM\"\n    },\n    \"messages\": [\n        {\n            \"name\": \"JsonObjectMessage\",\n            \"fields\": [\n                {\n                    \"rule\": \"required\",\n                    \"type\": \"string\",\n                    \"name\": \"data\",\n                    \"id\": 1\n                }\n            ]\n        },\n        {\n            \"name\": \"UnreadTuple\",\n            \"fields\": [\n                {\n                    \"rule\": \"required\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"required\",\n                    \"type\": \"int32\",\n                    \"name\": \"unread\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"mid\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"timestamp\",\n                    \"id\": 4\n                }\n            ]\n        },\n        {\n            \"name\": \"LogItem\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"from\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"data\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"timestamp\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"msgId\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"ackAt\",\n                    \"id\": 5\n                }\n            ]\n        },\n        {\n            \"name\": \"LoginCommand\",\n            \"fields\": []\n        },\n        {\n            \"name\": \"DataCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"ids\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"JsonObjectMessage\",\n                    \"name\": \"msg\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"offline\",\n                    \"id\": 3\n                }\n            ]\n        },\n        {\n            \"name\": \"SessionCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"t\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"n\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"s\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"ua\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"r\",\n                    \"id\": 5\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"tag\",\n                    \"id\": 6\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"deviceId\",\n                    \"id\": 7\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"sessionPeerIds\",\n                    \"id\": 8\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"onlineSessionPeerIds\",\n                    \"id\": 9\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"st\",\n                    \"id\": 10\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"stTtl\",\n                    \"id\": 11\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"code\",\n                    \"id\": 12\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"reason\",\n                    \"id\": 13\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"deviceToken\",\n                    \"id\": 14\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"sp\",\n                    \"id\": 15\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"detail\",\n                    \"id\": 16\n                }\n            ]\n        },\n        {\n            \"name\": \"ErrorCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"required\",\n                    \"type\": \"int32\",\n                    \"name\": \"code\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"required\",\n                    \"type\": \"string\",\n                    \"name\": \"reason\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"appCode\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"detail\",\n                    \"id\": 4\n                }\n            ]\n        },\n        {\n            \"name\": \"DirectCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"msg\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"uid\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"fromPeerId\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"timestamp\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"offline\",\n                    \"id\": 5\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"hasMore\",\n                    \"id\": 6\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"toPeerIds\",\n                    \"id\": 7\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"r\",\n                    \"id\": 10\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 11\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"id\",\n                    \"id\": 12\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"transient\",\n                    \"id\": 13\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"dt\",\n                    \"id\": 14\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"roomId\",\n                    \"id\": 15\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"pushData\",\n                    \"id\": 16\n                }\n            ]\n        },\n        {\n            \"name\": \"AckCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"code\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"reason\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"mid\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"t\",\n                    \"id\": 5\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"uid\",\n                    \"id\": 6\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"fromts\",\n                    \"id\": 7\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"tots\",\n                    \"id\": 8\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"type\",\n                    \"id\": 9\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"ids\",\n                    \"id\": 10\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"appCode\",\n                    \"id\": 11\n                }\n            ]\n        },\n        {\n            \"name\": \"UnreadCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"UnreadTuple\",\n                    \"name\": \"convs\",\n                    \"id\": 1\n                }\n            ]\n        },\n        {\n            \"name\": \"ConvCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"m\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"transient\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"unique\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cdate\",\n                    \"id\": 5\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"initBy\",\n                    \"id\": 6\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"sort\",\n                    \"id\": 7\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"limit\",\n                    \"id\": 8\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"skip\",\n                    \"id\": 9\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"flag\",\n                    \"id\": 10\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"count\",\n                    \"id\": 11\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"udate\",\n                    \"id\": 12\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"t\",\n                    \"id\": 13\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"n\",\n                    \"id\": 14\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"s\",\n                    \"id\": 15\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"statusSub\",\n                    \"id\": 16\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"statusPub\",\n                    \"id\": 17\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"statusTTL\",\n                    \"id\": 18\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"members\",\n                    \"id\": 19\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"JsonObjectMessage\",\n                    \"name\": \"results\",\n                    \"id\": 100\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"JsonObjectMessage\",\n                    \"name\": \"where\",\n                    \"id\": 101\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"JsonObjectMessage\",\n                    \"name\": \"attr\",\n                    \"id\": 103\n                }\n            ]\n        },\n        {\n            \"name\": \"RoomCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"roomId\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"s\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"t\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"n\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"transient\",\n                    \"id\": 5\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"roomPeerIds\",\n                    \"id\": 6\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"byPeerId\",\n                    \"id\": 7\n                }\n            ]\n        },\n        {\n            \"name\": \"LogsCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"l\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"limit\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"t\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"tt\",\n                    \"id\": 5\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"tmid\",\n                    \"id\": 6\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"mid\",\n                    \"id\": 7\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"checksum\",\n                    \"id\": 8\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"stored\",\n                    \"id\": 9\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"LogItem\",\n                    \"name\": \"logs\",\n                    \"id\": 105\n                }\n            ]\n        },\n        {\n            \"name\": \"RcpCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"id\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"t\",\n                    \"id\": 3\n                }\n            ]\n        },\n        {\n            \"name\": \"ReadTuple\",\n            \"fields\": [\n                {\n                    \"rule\": \"required\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int64\",\n                    \"name\": \"timestamp\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"mid\",\n                    \"id\": 3\n                }\n            ]\n        },\n        {\n            \"name\": \"ReadCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"cids\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"ReadTuple\",\n                    \"name\": \"convs\",\n                    \"id\": 3\n                }\n            ]\n        },\n        {\n            \"name\": \"PresenceCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"StatusType\",\n                    \"name\": \"status\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"repeated\",\n                    \"type\": \"string\",\n                    \"name\": \"sessionPeerIds\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"cid\",\n                    \"id\": 3\n                }\n            ]\n        },\n        {\n            \"name\": \"ReportCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"bool\",\n                    \"name\": \"initiative\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"type\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"data\",\n                    \"id\": 3\n                }\n            ]\n        },\n        {\n            \"name\": \"GenericCommand\",\n            \"fields\": [\n                {\n                    \"rule\": \"required\",\n                    \"type\": \"CommandType\",\n                    \"name\": \"cmd\",\n                    \"id\": 1\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"OpType\",\n                    \"name\": \"op\",\n                    \"id\": 2\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"appId\",\n                    \"id\": 3\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"peerId\",\n                    \"id\": 4\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"i\",\n                    \"id\": 5\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"string\",\n                    \"name\": \"installationId\",\n                    \"id\": 6\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"int32\",\n                    \"name\": \"priority\",\n                    \"id\": 7\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"LoginCommand\",\n                    \"name\": \"loginMessage\",\n                    \"id\": 100\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"DataCommand\",\n                    \"name\": \"dataMessage\",\n                    \"id\": 101\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"SessionCommand\",\n                    \"name\": \"sessionMessage\",\n                    \"id\": 102\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"ErrorCommand\",\n                    \"name\": \"errorMessage\",\n                    \"id\": 103\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"DirectCommand\",\n                    \"name\": \"directMessage\",\n                    \"id\": 104\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"AckCommand\",\n                    \"name\": \"ackMessage\",\n                    \"id\": 105\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"UnreadCommand\",\n                    \"name\": \"unreadMessage\",\n                    \"id\": 106\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"ReadCommand\",\n                    \"name\": \"readMessage\",\n                    \"id\": 107\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"RcpCommand\",\n                    \"name\": \"rcpMessage\",\n                    \"id\": 108\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"LogsCommand\",\n                    \"name\": \"logsMessage\",\n                    \"id\": 109\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"ConvCommand\",\n                    \"name\": \"convMessage\",\n                    \"id\": 110\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"RoomCommand\",\n                    \"name\": \"roomMessage\",\n                    \"id\": 111\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"PresenceCommand\",\n                    \"name\": \"presenceMessage\",\n                    \"id\": 112\n                },\n                {\n                    \"rule\": \"optional\",\n                    \"type\": \"ReportCommand\",\n                    \"name\": \"reportMessage\",\n                    \"id\": 113\n                }\n            ]\n        }\n    ],\n    \"enums\": [\n        {\n            \"name\": \"CommandType\",\n            \"values\": [\n                {\n                    \"name\": \"session\",\n                    \"id\": 0\n                },\n                {\n                    \"name\": \"conv\",\n                    \"id\": 1\n                },\n                {\n                    \"name\": \"direct\",\n                    \"id\": 2\n                },\n                {\n                    \"name\": \"ack\",\n                    \"id\": 3\n                },\n                {\n                    \"name\": \"rcp\",\n                    \"id\": 4\n                },\n                {\n                    \"name\": \"unread\",\n                    \"id\": 5\n                },\n                {\n                    \"name\": \"logs\",\n                    \"id\": 6\n                },\n                {\n                    \"name\": \"error\",\n                    \"id\": 7\n                },\n                {\n                    \"name\": \"login\",\n                    \"id\": 8\n                },\n                {\n                    \"name\": \"data\",\n                    \"id\": 9\n                },\n                {\n                    \"name\": \"room\",\n                    \"id\": 10\n                },\n                {\n                    \"name\": \"read\",\n                    \"id\": 11\n                },\n                {\n                    \"name\": \"presence\",\n                    \"id\": 12\n                },\n                {\n                    \"name\": \"report\",\n                    \"id\": 13\n                },\n                {\n                    \"name\": \"echo\",\n                    \"id\": 14\n                }\n            ]\n        },\n        {\n            \"name\": \"OpType\",\n            \"values\": [\n                {\n                    \"name\": \"open\",\n                    \"id\": 1\n                },\n                {\n                    \"name\": \"add\",\n                    \"id\": 2\n                },\n                {\n                    \"name\": \"remove\",\n                    \"id\": 3\n                },\n                {\n                    \"name\": \"close\",\n                    \"id\": 4\n                },\n                {\n                    \"name\": \"opened\",\n                    \"id\": 5\n                },\n                {\n                    \"name\": \"closed\",\n                    \"id\": 6\n                },\n                {\n                    \"name\": \"query\",\n                    \"id\": 7\n                },\n                {\n                    \"name\": \"query_result\",\n                    \"id\": 8\n                },\n                {\n                    \"name\": \"conflict\",\n                    \"id\": 9\n                },\n                {\n                    \"name\": \"added\",\n                    \"id\": 10\n                },\n                {\n                    \"name\": \"removed\",\n                    \"id\": 11\n                },\n                {\n                    \"name\": \"start\",\n                    \"id\": 30\n                },\n                {\n                    \"name\": \"started\",\n                    \"id\": 31\n                },\n                {\n                    \"name\": \"joined\",\n                    \"id\": 32\n                },\n                {\n                    \"name\": \"members_joined\",\n                    \"id\": 33\n                },\n                {\n                    \"name\": \"left\",\n                    \"id\": 39\n                },\n                {\n                    \"name\": \"members_left\",\n                    \"id\": 40\n                },\n                {\n                    \"name\": \"results\",\n                    \"id\": 42\n                },\n                {\n                    \"name\": \"count\",\n                    \"id\": 43\n                },\n                {\n                    \"name\": \"result\",\n                    \"id\": 44\n                },\n                {\n                    \"name\": \"update\",\n                    \"id\": 45\n                },\n                {\n                    \"name\": \"updated\",\n                    \"id\": 46\n                },\n                {\n                    \"name\": \"mute\",\n                    \"id\": 47\n                },\n                {\n                    \"name\": \"unmute\",\n                    \"id\": 48\n                },\n                {\n                    \"name\": \"status\",\n                    \"id\": 49\n                },\n                {\n                    \"name\": \"members\",\n                    \"id\": 50\n                },\n                {\n                    \"name\": \"join\",\n                    \"id\": 80\n                },\n                {\n                    \"name\": \"invite\",\n                    \"id\": 81\n                },\n                {\n                    \"name\": \"leave\",\n                    \"id\": 82\n                },\n                {\n                    \"name\": \"kick\",\n                    \"id\": 83\n                },\n                {\n                    \"name\": \"reject\",\n                    \"id\": 84\n                },\n                {\n                    \"name\": \"invited\",\n                    \"id\": 85\n                },\n                {\n                    \"name\": \"kicked\",\n                    \"id\": 86\n                },\n                {\n                    \"name\": \"upload\",\n                    \"id\": 100\n                },\n                {\n                    \"name\": \"uploaded\",\n                    \"id\": 101\n                }\n            ]\n        },\n        {\n            \"name\": \"StatusType\",\n            \"values\": [\n                {\n                    \"name\": \"on\",\n                    \"id\": 1\n                },\n                {\n                    \"name\": \"off\",\n                    \"id\": 2\n                }\n            ]\n        }\n    ]\n}).build();\n","import messages from './message-compiled';\n\nconst {\n  JsonObjectMessage,\n  UnreadTuple,\n  LogItem,\n  LoginCommand,\n  DataCommand,\n  SessionCommand,\n  ErrorCommand,\n  DirectCommand,\n  AckCommand,\n  UnreadCommand,\n  ConvCommand,\n  RoomCommand,\n  LogsCommand,\n  RcpCommand,\n  ReadTuple,\n  ReadCommand,\n  PresenceCommand,\n  ReportCommand,\n  GenericCommand,\n  CommandType,\n  OpType,\n  StatusType,\n} = messages.push_server.messages;\n\nexport {\n  JsonObjectMessage,\n  UnreadTuple,\n  LogItem,\n  LoginCommand,\n  DataCommand,\n  SessionCommand,\n  ErrorCommand,\n  DirectCommand,\n  AckCommand,\n  UnreadCommand,\n  ConvCommand,\n  RoomCommand,\n  LogsCommand,\n  RcpCommand,\n  ReadTuple,\n  ReadCommand,\n  PresenceCommand,\n  ReportCommand,\n  GenericCommand,\n  CommandType,\n  OpType,\n  StatusType,\n};\n","import { default as d } from 'debug';\nimport WebSocketPlus from './websocket-plus';\nimport { createError } from './error';\nimport { GenericCommand, CommandType } from '../proto/message';\nimport { trim } from './utils';\n\nconst debug = d('LC:Connection');\n\nconst COMMAND_TIMEOUT = 20000;\n\nexport default class Connection extends WebSocketPlus {\n  constructor(getUrl, { format, version }) {\n    debug('initializing Connection');\n    const protocolString = `lc.${format}.${version}`;\n    super(getUrl, protocolString);\n    this._protocalFormat = format;\n    this._commands = {};\n    this._serialId = 0;\n  }\n\n  send(command, waitingForRespond = true) {\n    let serialId;\n    if (waitingForRespond) {\n      this._serialId += 1;\n      serialId = this._serialId;\n      command.i = serialId; // eslint-disable-line no-param-reassign\n    }\n    debug('↑', trim(command), 'sent');\n\n    let message;\n    if (this._protocalFormat === 'protobase64') {\n      message = command.toBase64();\n    } else if (command.toBuffer) {\n      message = command.toBuffer();\n    } else if (command.toArrayBuffer) {\n      message = command.toArrayBuffer();\n    }\n    if (!message) {\n      throw new TypeError(`${command} is not a GenericCommand`);\n    }\n\n    super.send(message);\n\n    if (!waitingForRespond) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      this._commands[serialId] = {\n        resolve,\n        reject,\n      };\n      setTimeout(\n        () => {\n          if (this._commands[serialId]) {\n            debug('✗', trim(command), 'timeout');\n            reject(new Error('Command Timeout.'));\n            delete this._commands[serialId];\n          }\n        },\n        COMMAND_TIMEOUT\n      );\n    });\n  }\n\n  handleMessage(msg) {\n    let message;\n    try {\n      message = GenericCommand.decode(msg);\n      debug('↓', trim(message), 'received');\n    } catch (e) {\n      console.warn('Decode message failed', msg);\n    }\n    this.emit('allmessage', message);\n    const serialId = message.i;\n    if (serialId) {\n      if (this._commands[serialId]) {\n        if (message.cmd === CommandType.error) {\n          this\n            ._commands[serialId]\n            .reject(createError(message.errorMessage));\n        } else {\n          this\n            ._commands[serialId]\n            .resolve(message);\n        }\n        delete this._commands[serialId];\n      } else {\n        console.warn(`Unexpected command received with serialId [${serialId}],\n         which have timed out or never been requested.`);\n      }\n    } else if (message.cmd === CommandType.error) {\n      this.emit('error', createError(message.errorMessage));\n    } else {\n      this.emit('message', message);\n    }\n  }\n\n  ping() {\n    return this.send(new GenericCommand({\n      cmd: 'echo',\n    })).catch(error => console.warn('ping failed:', error));\n  }\n}\n","/* eslint-disable max-len */\n\n/**\n * 插件接口\n *\n * 插件是由一个或多个扩展点的 Decorator 或 Middleware 组成的字典。SDK 的扩展点可以分为两类：\n * <p>\n * 第一类扩展点是类实例化之后的回调，包括 <code>Realtime</code>、<code>IMClient</code> 与 <code>Conversation</code>。这些扩展点可以通过一个同步的 Decorator 进行扩展。Decorator 接受一个对应的实例并对其进行一些操作。\n * 特别的，由于注册自定义消息类这个需求特别的常用，额外定义一个 messageClasses 扩展点来做这件事情。\n * <p>\n * 第二类扩展点是在某些事件处理前、后可以注入逻辑的点。目前可扩展的点有 <code>beforeMessageParse</code>，<code>afterMessageParse</code>。这些扩展点可以通过一个异步的 Middleware 进行扩展。Middleware 接受一个对象，返回一个同类型对象或同类型对象的 Promise。\n * <p>\n * 如果使用了多个插件，这些 hook 会按照插件数组的顺序依次执行。前一个 Middleware 的返回值会作为参数传给后一个 Middleware。\n *\n * @interface Plugin\n * @since 3.1.0\n */\n\n/* eslint-enable max-len */\n\n/**\n * 插件名称，用于在日志中显示异常的插件\n *\n * @name Plugin.name\n * @type string\n */\n\n/**\n * 插件注册的消息类型\n *\n * @name Plugin.messageClasses\n * @type AVMessage[]\n */\n\n/**\n * 在 Realtime 实例化后对其进行修饰。\n * <p>\n * 接受一个参数为 Realtime 实例。\n *\n * @name Plugin.onRealtimeCreate\n * @type Function\n */\n\n/**\n * 在 IMClient 实例化后对其进行修饰。\n * <p>\n * 接受一个参数为 IMClient 实例。\n *\n * @name Plugin.onIMClientCreate\n * @type Function\n */\n\n/**\n * 在 Conversation 实例化后对其进行修饰。\n * <p>\n * 接受一个参数为 Conversation 实例。\n * 需要注意的是，该扩展点并不是在 <code>{@link IMClient#createConversation}</code> 方法创建成功后调用的 hook，\n * 而是所有的 Conversation 实例化的时候（包括但不限于 query 时）调用的 hook。\n *\n * @name Plugin.onConversationCreate\n * @type Function\n */\n\n/**\n * 在对消息进行 parse 之前，对原始消息进行修改。\n * <p>\n * 接受一个参数为原始消息，是某个消息 JSON 化（<code>message.toJSON()</code>）的返回值，一般是一个 JSON 对象。\n * 该方法需要返回一个 JSON 对象。如果这个结果是异步得到的，也可以返回一个 Promise(fulfilled with a JSON)。\n *\n * @name Plugin.beforeMessageParse\n * @type Function\n */\n\n/**\n * 在对消息进行 parse 之后，对消息实例进行修改。\n * <p>\n * 接受一个参数为消息实例，一般是一个已注册的 Message 类或其子类的实例。\n * 该方法需要返回一个同类型的消息实例。如果这个结果是异步得到的，也可以返回一个 Promise。\n *\n * @name Plugin.beforeMessageParse\n * @type Function\n */\n\nimport { ensureArray, tap } from './utils';\n\nconst checkType = middleware => (param) => {\n  const { constructor } = param;\n  return Promise.resolve(param).then(middleware).then(tap((result) => {\n    if (result === undefined || result === null) {\n      // eslint-disable-next-line max-len\n      return console.warn(`Middleware[${middleware._pluginName || 'anonymous plugin'}:${middleware.name || 'anonymous middleware'}] param/return types not match. It returns ${result} while a ${param.constructor.name} expected.`);\n    }\n    if (!(result instanceof constructor)) {\n      // eslint-disable-next-line max-len\n      return console.warn(`Middleware[${middleware._pluginName || 'anonymous plugin'}:${middleware.name || 'anonymous middleware'}] param/return types not match. It returns a ${result.constructor.name} while a ${param.constructor.name} expected.`);\n    }\n    return 0;\n  }));\n};\n\nexport const applyDecorators = (decorators, target) => {\n  if (decorators) {\n    for (const decorator of decorators) {\n      try {\n        decorator(target);\n      } catch (error) {\n        if (decorator._pluginName) {\n          error.message += `[${decorator._pluginName}]`;\n        }\n        throw error;\n      }\n    }\n  }\n};\n\nexport const applyMiddlewares = middlewares => target =>\n  ensureArray(middlewares).reduce(\n    (previousPromise, middleware) => previousPromise\n      .then(checkType(middleware))\n      .catch((error) => {\n        if (middleware._pluginName) {\n          // eslint-disable-next-line no-param-reassign\n          error.message += `[${middleware._pluginName}]`;\n        }\n        throw error;\n      }),\n    Promise.resolve(target)\n  );\n","import EventEmitter from 'eventemitter3';\n\nexport default class Client extends EventEmitter {\n  constructor(id, options = {}, connection, props) {\n    if (!(id === undefined || typeof id === 'string')) {\n      throw new TypeError(`Client id [${id}] is not a String`);\n    }\n    super();\n    Object.assign(this, {\n      id,\n      _connection: connection,\n      options,\n    }, props);\n  }\n\n  /**\n   * @abstract\n   */\n  _dispatchMessage(message) {\n    this.emit('message', message);\n  }\n}\n","import { default as d } from 'debug';\n\nconst debug = d('LC:ConversationQuery');\n\nexport default class ConversationQuery {\n  static _encode(value) {\n    if (value instanceof Date) {\n      return { __type: 'Date', iso: value.toJSON() };\n    }\n    if (value instanceof RegExp) {\n      return value.source;\n    }\n    return value;\n  }\n\n  static _quote(s) {\n    return `\\\\Q${s.replace('\\\\E', '\\\\E\\\\\\\\E\\\\Q')}\\\\E`;\n  }\n\n  static _calculateFlag(options) {\n    return [\n      'withLastMessagesRefreshed',\n      'compact',\n    ].reduce(\n      // eslint-disable-next-line no-bitwise\n      (prev, key) => (prev << 1) + (Boolean)(options[key]),\n      0\n    );\n  }\n\n  /**\n   * Create a ConversationQuery\n   * @param  {IMClient} client\n   */\n  constructor(client) {\n    this._client = client;\n    this._where = {};\n    this._extraOptions = {};\n  }\n\n  _addCondition(key, condition, value) {\n    // Check if we already have a condition\n    if (!this._where[key]) {\n      this._where[key] = {};\n    }\n    this._where[key][condition] = this.constructor._encode(value);\n    return this;\n  }\n\n  toJSON() {\n    const json = {\n      where: this._where,\n      flag: this.constructor._calculateFlag(this._extraOptions),\n    };\n    if (typeof this._skip !== 'undefined') json.skip = this._skip;\n    if (typeof this._limit !== 'undefined') json.limit = this._limit;\n    if (typeof this._order !== 'undefined') json.sort = this._order;\n    debug(json);\n    return json;\n  }\n\n  /**\n   * 增加查询条件，指定聊天室的组员包含某些成员即可返回\n   * @param {string[]} peerIds - 成员 ID 列表\n   * @return {ConversationQuery} self\n   */\n  containsMembers(peerIds) {\n    return this.containsAll('m', peerIds);\n  }\n\n  /**\n   * 增加查询条件，指定聊天室的组员条件满足条件的才返回\n   *\n   * @param {string[]} - 成员 ID 列表\n   * @param {Boolean} includeSelf - 是否包含自己\n   * @return {ConversationQuery} self\n   */\n  withMembers(peerIds, includeSelf) {\n    const peerIdsSet = new Set(peerIds);\n    if (includeSelf) {\n      peerIdsSet.add(this._client.id);\n    }\n    this.sizeEqualTo('m', peerIdsSet.size);\n    return this.containsMembers(Array.from(peerIdsSet));\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段满足等于条件时即可返回\n   *\n   * @param {string} key\n   * @param value\n   * @return {ConversationQuery} self\n   */\n  equalTo(key, value) {\n    this._where[key] = this.constructor._encode(value);\n    return this;\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段满足小于条件时即可返回\n   * @param {string} key\n   * @param value\n   * @return {ConversationQuery} self\n   */\n  lessThan(key, value) {\n    return this._addCondition(key, '$lt', value);\n  }\n\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段满足小于等于条件时即可返回\n\n   * @param {string} key\n   * @param value\n   * @return {ConversationQuery} self\n   */\n  lessThanOrEqualTo(key, value) {\n    return this._addCondition(key, '$lte', value);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段满足大于条件时即可返回\n   *\n   * @param {string} key\n   * @param value\n   * @return {ConversationQuery} self\n   */\n\n  greaterThan(key, value) {\n    return this._addCondition(key, '$gt', value);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段满足大于等于条件时即可返回\n   *\n   * @param {string} key\n   * @param value\n   * @return {ConversationQuery} self\n   */\n\n  greaterThanOrEqualTo(key, value) {\n    return this._addCondition(key, '$gte', value);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段满足不等于条件时即可返回\n   *\n   * @param {string} key\n   * @param value\n   * @return {ConversationQuery} self\n   */\n  notEqualTo(key, value) {\n    return this._addCondition(key, '$ne', value);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段对应的值包含在指定值中时即可返回\n   *\n   * @param {string} key\n   * @param values\n   * @return {ConversationQuery} self\n   */\n  containedIn(key, values) {\n    return this._addCondition(key, '$in', values);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段对应的值不包含在指定值中时即可返回\n   *\n   * @param {string} key\n   * @param values\n   * @return {ConversationQuery} self\n   */\n  notContainsIn(key, values) {\n    return this._addCondition(key, '$nin', values);\n  }\n  /**\n   * 增加查询条件，当conversation的属性中对应的字段中的元素包含所有的值才可返回\n   *\n   * @param {string} key\n   * @param values\n   * @return {ConversationQuery} self\n   */\n  containsAll(key, values) {\n    return this._addCondition(key, '$all', values);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段对应的值包含此字符串即可返回\n   *\n   * @param {string} key\n   * @param {string} subString\n   * @return {ConversationQuery} self\n   */\n  contains(key, subString) {\n    return this._addCondition(key, '$regex', ConversationQuery._quote(subString));\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段对应的值以此字符串起始即可返回\n   *\n   * @param {string} key\n   * @param {string} prefix\n   * @return {ConversationQuery} self\n   */\n  startsWith(key, prefix) {\n    return this._addCondition(key, '$regex', `^${ConversationQuery._quote(prefix)}`);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段对应的值以此字符串结束即可返回\n   *\n   * @param {string} key\n   * @param {string} suffix\n   * @return {ConversationQuery} self\n   */\n  endsWith(key, suffix) {\n    return this._addCondition(key, '$regex', `${ConversationQuery._quote(suffix)}$`);\n  }\n\n  /**\n   * 增加查询条件，当 conversation 的属性中对应的字段对应的值满足提供的正则表达式即可返回\n   *\n   * @param {string} key\n   * @param {RegExp} regex\n   * @return {ConversationQuery} self\n   */\n  matches(key, regex) {\n    this._addCondition(key, '$regex', regex);\n    // Javascript regex options support mig as inline options but store them\n    // as properties of the object. We support mi & should migrate them to\n    // modifiers\n    let _modifiers = '';\n    if (regex.ignoreCase) { _modifiers += 'i'; }\n    if (regex.multiline) { _modifiers += 'm'; }\n\n    if (_modifiers && _modifiers.length) {\n      this._addCondition(key, '$options', _modifiers);\n    }\n    return this;\n  }\n\n  /**\n   * 添加查询约束条件，查找 key 类型是数组，该数组的长度匹配提供的数值\n   *\n   * @param {string} key\n   * @param {Number} length\n   * @return {ConversationQuery} self\n   */\n  sizeEqualTo(key, length) {\n    return this._addCondition(key, '$size', length);\n  }\n\n  /**\n   * 设置返回集合的大小上限\n   *\n   * @param {Number} limit - 上限\n   * @return {ConversationQuery} self\n   */\n  limit(limit) {\n    this._limit = limit;\n    return this;\n  }\n\n  /**\n   * 设置返回集合的起始位置，一般用于分页\n   *\n   * @param {Number} skip - 起始位置跳过几个对象\n   * @return {ConversationQuery} self\n   */\n  skip(skip) {\n    this._skip = skip;\n    return this;\n  }\n\n  /**\n   * 设置返回集合按照指定key进行增序排列\n   *\n   * @param {string} key\n   * @return {ConversationQuery} self\n   */\n  ascending(key) {\n    this._order = key;\n    return this;\n  }\n\n  /**\n   * 设置返回集合按照指定key进行增序排列，如果已设置其他排序，原排序的优先级较高\n   *\n   * @param {string} key\n   * @return {ConversationQuery} self\n   */\n  addAscending(key) {\n    if (this._order) {\n      this._order += `,${key}`;\n    } else {\n      this._order = key;\n    }\n    return this;\n  }\n\n  /**\n   * 设置返回集合按照指定 key 进行降序排列\n   *\n   * @param {string} key\n   * @return {ConversationQuery} self\n   */\n  descending(key) {\n    this._order = `-${key}`;\n    return this;\n  }\n\n  /**\n   * 设置返回集合按照指定 key 进行降序排列，如果已设置其他排序，原排序的优先级较高\n   *\n   * @param {string} key\n   * @return {ConversationQuery} self\n   */\n  addDescending(key) {\n    if (this._order) {\n      this._order += `,-${key}`;\n    } else {\n      this._order = `-${key}`;\n    }\n    return this;\n  }\n\n  /**\n   * 设置返回的 conversations 刷新最后一条消息\n   * @param  {Boolean} [enabled=true]\n   * @return {ConversationQuery} self\n   */\n  withLastMessagesRefreshed(enabled = true) {\n    this._extraOptions.withLastMessagesRefreshed = enabled;\n    return this;\n  }\n\n  /**\n   * @deprecated 请替换为 {@link ConversationQuery#withLastMessagesRefreshed}\n   * @param  {Boolean} [enabled=true]\n   * @return {ConversationQuery} self\n   */\n  withLastMessages(enabled) {\n    console.warn('DEPRECATION ConversationQuery#withLastMessages: ' +\n      'Use ConversationQuery#withLastMessagesRefreshed instead.');\n    return this.withLastMessagesRefreshed(enabled);\n  }\n\n  /**\n   * 设置返回的 conversations 为精简模式，即不含成员列表\n   * @param  {Boolean} [enabled=true]\n   * @return {ConversationQuery} self\n   */\n  compact(enabled = true) {\n    this._extraOptions.compact = enabled;\n    return this;\n  }\n\n  /**\n   * 执行查询\n   * @return {Promise.<Conversation[]>}\n   */\n  find() {\n    return this._client._executeQuery(this);\n  }\n}\n","import { default as d } from 'debug';\nimport { tap } from './utils';\n\nconst debug = d('LC:SignatureFactoryRunner');\n\nfunction _validateSignature(signatureResult = {}) {\n  const {\n    signature,\n    timestamp,\n    nonce,\n  } = signatureResult;\n  if (typeof signature !== 'string'\n      || typeof timestamp !== 'number'\n      || typeof nonce !== 'string') {\n    throw new Error('malformed signature');\n  }\n  return {\n    signature,\n    timestamp,\n    nonce,\n  };\n}\n\nexport default (signatureFactory, params) =>\n  Promise.resolve()\n    .then(() => {\n      debug(`call signatureFactory with ${params}`);\n      return signatureFactory(...params);\n    })\n    .then(\n      tap(signatureResult => debug('sign result', signatureResult)),\n      (error) => {\n        // eslint-disable-next-line no-param-reassign\n        error.message = `sign error: ${error.message}`;\n        debug(error);\n        throw error;\n      }\n    )\n    .then(_validateSignature);\n","import uuid from 'uuid';\n\n\n/**\n * 消息状态枚举\n * @enum {Symbol}\n * @since 3.2.0\n * @memberof module:leancloud-realtime\n */\nconst MessageStatus = {\n  /** 初始状态、未知状态 */\n  NONE: Symbol('none'),\n  /** 正在发送 */\n  SENDING: Symbol('sending'),\n  /** 已发送 */\n  SENT: Symbol('sent'),\n  /** 已送达 */\n  DELIVERED: Symbol('delivered'),\n  /** 发送失败 */\n  FAILED: Symbol('failed'),\n};\nObject.freeze(MessageStatus);\n\nconst rMessageStatus = {\n  [MessageStatus.NONE]: true,\n  [MessageStatus.SENDING]: true,\n  [MessageStatus.SENT]: true,\n  [MessageStatus.DELIVERED]: true,\n  [MessageStatus.FAILED]: true,\n};\n\nexport { MessageStatus };\nexport default class Message {\n  /**\n   * @implements AVMessage\n   * @param  {Object|String} content 消息内容\n   */\n  constructor(content) {\n    Object.assign(this, { content }, {\n      /**\n       * @type {String}\n       * @memberof Message#\n       */\n      id: uuid.v4(),\n      /**\n       * 消息所在的 conversation id\n       * @memberof Message#\n       * @type {String?}\n       */\n      cid: null,\n      /**\n       * 时间戳\n       * @memberof Message#\n       * @type {Date}\n       */\n      timestamp: new Date(),\n      /**\n       * 消息发送者\n       * @memberof Message#\n       * @type {String}\n       */\n      from: undefined,\n      /**\n       * 标记需要回执\n       * @memberof Message#\n       * @type {Boolean}\n       */\n      needReceipt: false,\n      /**\n       * 标记暂态消息\n       * @memberof Message#\n       * @type {Boolean}\n       */\n      transient: false,\n      /**\n       * @var deliveredAt {?Date} 消息送达时间\n       * @memberof Message#\n       */\n      // deliveredAt,\n    });\n    this._setStatus(MessageStatus.NONE);\n  }\n\n  /**\n   * 设置是否需要送达回执\n   * @param {Boolean} needReceipt\n   * @return {Message} self\n   */\n  setNeedReceipt(needReceipt) {\n    this.needReceipt = needReceipt;\n    return this;\n  }\n\n  /**\n   * 设置是否是暂态消息\n   * @param {Boolean} transient\n   * @return {Message} self\n   */\n  setTransient(transient) {\n    this.transient = transient;\n    return this;\n  }\n\n  /**\n   * 将当前消息序列化为 JSON 对象\n   * @protected\n   * @return {Object}\n   */\n  toJSON() {\n    return this.content;\n  }\n\n  /**\n   * 消息状态，值为 {@link module:leancloud-realtime.MessageStatus} 之一\n   * @type {Symbol}\n   * @readonly\n   * @since 3.2.0\n   */\n  get status() {\n    return this._status;\n  }\n\n  _setStatus(status) {\n    if (!rMessageStatus[status]) {\n      throw new Error('Invalid message status');\n    }\n    this._status = status;\n  }\n\n  /**\n   * 判断给定的内容是否是有效的 Message，\n   * 该方法始终返回 true\n   * @protected\n   * @returns {Boolean}\n   * @implements AVMessage.validate\n   */\n  static validate() {\n    return true;\n  }\n\n  /**\n   * 解析处理消息内容\n   * <pre>\n   * 如果子类提供了 message，返回该 message\n   * 如果没有提供，将 json 作为 content 实例化一个 Message\n   * @protected\n   * @param  {Object}  json    json 格式的消息内容\n   * @param  {Message} message 子类提供的 message\n   * @return {Message}\n   * @implements AVMessage.parse\n   */\n  static parse(json, message) {\n    return message || new this(json);\n  }\n}\n","import throttle from 'lodash/throttle';\nimport EventEmitter from 'eventemitter3';\nimport { default as d } from 'debug';\nimport Client from './client';\nimport Conversation from './conversation';\nimport ConversationQuery from './conversation-query';\nimport {\n  GenericCommand,\n  SessionCommand,\n  ConvCommand,\n  AckCommand,\n  JsonObjectMessage,\n  ReadCommand,\n  ReadTuple,\n  CommandType,\n  OpType,\n} from '../proto/message';\nimport { ErrorCode } from './error';\nimport { tap, Expirable, Cache, keyRemap, union, difference, trim, internal } from './utils';\nimport { applyDecorators } from './plugin';\nimport runSignatureFactory from './signature-factory-runner';\nimport { MessageStatus } from './messages/message';\nimport { OnlineStatus } from '.';\nimport { version as VERSION } from '../package.json';\n\nconst debug = d('LC:IMClient');\n\nexport default class IMClient extends Client {\n  /**\n   * 无法直接实例化，请使用 {@link Realtime#createIMClient} 创建新的 IMClient。\n   *\n   * @extends EventEmitter\n   * @param  {String} [id] 客户端 id\n   * @param  {Object} [options]\n   * @param  {Function} [options.signatureFactory] open session 时的签名方法 // TODO need details\n   * @param  {Function} [options.conversationSignatureFactory] 对话创建、增减成员操作时的签名方法\n   */\n  constructor(...args) {\n    /**\n     * @var id {String} 客户端 id\n     * @memberof IMClient#\n     */\n    super(...args);\n    if (!this._messageParser) {\n      throw new Error('IMClient must be initialized with a MessageParser');\n    }\n    this._conversationCache = new Cache(`client:${this.id}`);\n    this._ackMessageBuffer = {};\n    internal(this)._eventemitter = new EventEmitter();\n    [\n      'invited',\n      'kicked',\n      'membersjoined',\n      'membersleft',\n      'message',\n      'unreadmessages',\n      'close',\n      'conflict',\n      'unhandledmessage',\n    ].forEach(event => this.on(\n      event,\n      (...payload) => this._debug(`${event} event emitted.`, ...payload)\n    ));\n    // onIMClientCreate hook\n    applyDecorators(this._plugins.onIMClientCreate, this);\n  }\n\n  _debug(...params) {\n    debug(...params, `[${this.id}]`);\n  }\n\n  /**\n   * @override\n   * @private\n   */\n  _dispatchMessage(message) {\n    this._debug(trim(message), 'received');\n    switch (message.cmd) {\n      case CommandType.conv:\n        return this._dispatchConvMessage(message);\n      case CommandType.direct:\n        return this._dispatchDirectMessage(message);\n      case CommandType.session:\n        return this._dispatchSessionMessage(message);\n      case CommandType.unread:\n        return this._dispatchUnreadMessage(message);\n      case CommandType.rcp:\n        return this._dispatchRcpMessage(message);\n      case CommandType.presence:\n        return this._dispatchPresenceMessage(message);\n      default:\n        this.emit('unhandledmessage', message);\n        return Promise.resolve();\n    }\n  }\n\n  _dispatchSessionMessage(message) {\n    const {\n      sessionMessage: {\n        code, reason,\n      },\n    } = message;\n    switch (message.op) {\n      case OpType.closed: {\n        if (code === ErrorCode.SESSION_CONFLICT) {\n          /**\n           * 用户在其他客户端登录，当前客户端被服务端强行下线。详见文档「单点登录」章节。\n           * @event IMClient#conflict\n           */\n          return this.emit('conflict', {\n            reason,\n          });\n        }\n        /**\n         * 当前客户端被服务端强行下线\n         * @event IMClient#close\n         * @param {Object} payload\n         * @param {Number} payload.code 错误码\n         * @param {String} payload.reason 原因\n         */\n        return this.emit('close', {\n          code, reason,\n        });\n      }\n      default:\n        this.emit('unhandledmessage', message);\n        return Promise.reject(new Error('Unrecognized session command'));\n    }\n  }\n\n  _dispatchUnreadMessage(message) {\n    const convs = message.unreadMessage.convs;\n    return Promise.all(convs.map(\n      conv => this\n        .getConversation(conv.cid)\n        .then((conversation) => {\n          let timestamp;\n          if (conv.timestamp) {\n            timestamp = new Date(conv.timestamp.toNumber());\n            conversation.lastMessageAt = timestamp; // eslint-disable-line no-param-reassign\n          }\n          conversation.unreadMessagesCount = conv.unread; // eslint-disable-line no-param-reassign\n          /**\n           * 未读消息数目更新\n           * @event IMClient#unreadmessages\n           * @param {Object} payload\n           * @param {Number} payload.count 未读消息数\n           * @param {String} [payload.lastMessageId] 最新一条未读消息 id\n           * @param {Date} [payload.lastMessageTimestamp] 最新一条未读消息时间戳\n           * @param {Conversation} conversation 未读消息数目有更新的对话\n           */\n          this.emit('unreadmessages', {\n            count: conv.unread,\n            lastMessageId: conv.mid,\n            lastMessageTimestamp: timestamp,\n          }, conversation);\n        })\n    ));\n  }\n\n  _dispatchRcpMessage(message) {\n    const {\n      rcpMessage,\n    } = message;\n    const conversationId = rcpMessage.cid;\n    const messageId = rcpMessage.id;\n    const deliveredAt = new Date(rcpMessage.t.toNumber());\n    const conversation = this._conversationCache.get(conversationId);\n    // conversation not cached means the client does not send the message\n    // during this session\n    if (!conversation) return;\n    conversation._handleReceipt({ messageId, deliveredAt });\n  }\n\n  _dispatchConvMessage(message) {\n    const {\n      convMessage,\n      convMessage: {\n        initBy, m,\n      },\n    } = message;\n    switch (message.op) {\n      case OpType.joined: {\n        return this.getConversation(convMessage.cid).then((conversation) => {\n          if (!conversation.transient) {\n            // eslint-disable-next-line no-param-reassign\n            conversation.members = union(conversation.members, [this.id]);\n          }\n          const payload = {\n            invitedBy: initBy,\n          };\n          /**\n           * 当前用户被添加至某个对话\n           * @event IMClient#invited\n           * @param {Object} payload\n           * @param {String} payload.invitedBy 邀请者 id\n           * @param {Conversation} conversation\n           */\n          this.emit('invited', payload, conversation);\n          /**\n           * 当前用户被添加至当前对话\n           * @event Conversation#invited\n           * @param {Object} payload\n           * @param {String} payload.invitedBy 该移除操作的发起者 id\n           */\n          conversation.emit('invited', payload);\n        });\n      }\n      case OpType.left: {\n        return this.getConversation(convMessage.cid).then((conversation) => {\n          if (!conversation.transient) {\n            // eslint-disable-next-line no-param-reassign\n            conversation.members = difference(conversation.members, [this.id]);\n          }\n          const payload = {\n            kickedBy: initBy,\n          };\n          /**\n           * 当前用户被从某个对话中移除\n           * @event IMClient#kicked\n           * @param {Object} payload\n           * @param {String} payload.kickedBy 该移除操作的发起者 id\n           * @param {Conversation} conversation\n           */\n          this.emit('kicked', payload, conversation);\n          /**\n           * 当前用户被从当前对话中移除\n           * @event Conversation#kicked\n           * @param {Object} payload\n           * @param {String} payload.kickedBy 该移除操作的发起者 id\n           */\n          conversation.emit('kicked', payload);\n        });\n      }\n      case OpType.members_joined: {\n        return this.getConversation(convMessage.cid).then((conversation) => {\n          if (!conversation.transient) {\n            // eslint-disable-next-line no-param-reassign\n            conversation.members = union(conversation.members, convMessage.m);\n          }\n          const payload = {\n            invitedBy: initBy,\n            members: m,\n          };\n          /**\n           * 有用户被添加至某个对话\n           * @event IMClient#membersjoined\n           * @param {Object} payload\n           * @param {String[]} payload.members 被添加的用户 id 列表\n           * @param {String} payload.invitedBy 邀请者 id\n           * @param {Conversation} conversation\n           */\n          this.emit('membersjoined', payload, conversation);\n          /**\n           * 有成员被添加至当前对话\n           * @event Conversation#membersjoined\n           * @param {Object} payload\n           * @param {String[]} payload.members 被添加的成员 id 列表\n           * @param {String} payload.invitedBy 邀请者 id\n           */\n          conversation.emit('membersjoined', payload);\n        });\n      }\n      case OpType.members_left: {\n        return this.getConversation(convMessage.cid).then((conversation) => {\n          if (!conversation.transient) {\n            // eslint-disable-next-line no-param-reassign\n            conversation.members = difference(conversation.members, convMessage.m);\n          }\n          const payload = {\n            kickedBy: initBy,\n            members: m,\n          };\n          /**\n           * 有成员被从某个对话中移除\n           * @event IMClient#membersleft\n           * @param {Object} payload\n           * @param {String[]} payload.members 被移除的成员 id 列表\n           * @param {String} payload.kickedBy 该移除操作的发起者 id\n           * @param {Conversation} conversation\n           */\n          this.emit('membersleft', payload, conversation);\n          /**\n           * 有成员被从当前对话中移除\n           * @event Conversation#membersleft\n           * @param {Object} payload\n           * @param {String[]} payload.members 被移除的成员 id 列表\n           * @param {String} payload.kickedBy 该移除操作的发起者 id\n           */\n          conversation.emit('membersleft', payload);\n        });\n      }\n      default:\n        this.emit('unhandledmessage', message);\n        return Promise.reject(new Error('Unrecognized conversation command'));\n    }\n  }\n\n  _dispatchPresenceMessage({ presenceMessage }) {\n    return this.getConversation(presenceMessage.cid).then((conversation) => {\n      /**\n       * 对话成员的在线状态发生变化\n       * @event Conversation#membersstatuschange\n       * @param {Object} payload\n       * @param {String[]} payload.members 成员 id 列表\n       * @param {Symbol} payload.status 新的在线状态，值为 {@link module:leancloud-realtime.OnlineStatus} 之一\n       */\n      conversation.emit('membersstatuschange', {\n        members: presenceMessage.sessionPeerIds,\n        // online: 1, offline: 2\n        status: OnlineStatus[['', 'ONLINE', 'OFFLINE'][presenceMessage.status]],\n      });\n    });\n  }\n\n  _dispatchDirectMessage(originalMessage) {\n    const {\n      directMessage,\n      directMessage: {\n        id, cid, fromPeerId, timestamp, transient,\n      },\n    } = originalMessage;\n    return Promise.all([\n      this.getConversation(directMessage.cid),\n      this._messageParser.parse(directMessage.msg),\n    ]).then(([conversation, message]) => {\n      const messageProps = {\n        id,\n        cid,\n        timestamp: new Date(timestamp.toNumber()),\n        from: fromPeerId,\n        transient,\n      };\n      Object.assign(message, messageProps);\n      message._setStatus(MessageStatus.SENT);\n      conversation.lastMessage = message; // eslint-disable-line no-param-reassign\n      conversation.lastMessageAt = message.timestamp; // eslint-disable-line no-param-reassign\n      conversation.unreadMessagesCount += 1; // eslint-disable-line no-param-reassign\n      /**\n       * 当前用户收到消息\n       * @event IMClient#message\n       * @param {Message} message\n       * @param {Conversation} conversation 收到消息的对话\n       */\n      this.emit('message', message, conversation);\n      /**\n       * 当前对话收到消息\n       * @event Conversation#message\n       * @param {Message} message\n       */\n      conversation.emit('message', message);\n      if (!(transient || conversation.transient)) {\n        this._sendAck(message);\n      }\n    });\n  }\n\n  _sendAck(message) {\n    this._debug('send ack for', message);\n    const { cid } = message;\n    if (!cid) {\n      return Promise.reject(new Error('missing cid'));\n    }\n    if (!this._ackMessageBuffer[cid]) {\n      this._ackMessageBuffer[cid] = [];\n    }\n    this._ackMessageBuffer[cid].push(message);\n    if (!this._doSendAckThrottled) {\n      this._doSendAckThrottled = throttle(this._doSendAck.bind(this), 1000);\n    }\n    return this._doSendAckThrottled();\n  }\n\n  _doSendAck() {\n    if (!this._connection.is('connected')) {\n      // if not connected, just skip everything\n      return Promise.resolve();\n    }\n    debug('do send ack', this._ackMessageBuffer);\n    return Promise.all(Object.keys(this._ackMessageBuffer).map((cid) => {\n      const convAckMessages = this._ackMessageBuffer[cid];\n      const timestamps = convAckMessages.map(message => message.timestamp);\n      const command = new GenericCommand({\n        cmd: 'ack',\n        ackMessage: new AckCommand({\n          cid,\n          fromts: Math.min.apply(null, timestamps),\n          tots: Math.max.apply(null, timestamps),\n        }),\n      });\n      return this._send(command, false)\n        .then(() => delete this._ackMessageBuffer[cid])\n        .catch(error => console.warn('send ack failed:', error));\n    }));\n  }\n\n  _send(cmd, ...args) {\n    const command = cmd;\n    if (this.id) {\n      command.peerId = this.id;\n    }\n    return this._connection.send(command, ...args);\n  }\n\n  _open(appId, tag, deviceId, isReconnect = false) {\n    this._debug('open session');\n    return Promise\n      .resolve(new GenericCommand({\n        cmd: 'session',\n        op: 'open',\n        appId,\n        sessionMessage: new SessionCommand({\n          ua: `js/${VERSION}`,\n          r: isReconnect,\n        }),\n      }))\n      .then((command) => {\n        if (isReconnect) {\n          // if sessionToken is not expired, skip signature/tag/deviceId\n          const sessionToken = internal(this).sessionToken;\n          if (sessionToken) {\n            const value = sessionToken.value;\n            if (value && value !== Expirable.EXPIRED) {\n              Object.assign(command.sessionMessage, {\n                st: value,\n              });\n              return command;\n            }\n          }\n        }\n        Object.assign(command.sessionMessage, trim({\n          tag,\n          deviceId,\n        }));\n        if (this.options.signatureFactory) {\n          return runSignatureFactory(this.options.signatureFactory, [this.id])\n            .then((signatureResult) => {\n              Object.assign(command.sessionMessage, keyRemap({\n                signature: 's',\n                timestamp: 't',\n                nonce: 'n',\n              }, signatureResult));\n              return command;\n            });\n        }\n        return command;\n      })\n      .then(this._send.bind(this))\n      .then((resCommand) => {\n        const {\n          peerId,\n          sessionMessage: {\n            st: token,\n            stTtl: tokenTTL,\n          },\n        } = resCommand;\n        if (!peerId) {\n          console.warn('Unexpected session opened without peerId.');\n          return;\n        }\n        this.id = peerId;\n        if (token) {\n          internal(this).sessionToken = new Expirable(token, tokenTTL * 1000);\n        }\n      }, (error) => {\n        if (error.code === ErrorCode.SESSION_TOKEN_EXPIRED) {\n          if (internal(this).sessionToken === undefined) {\n            // let it fail if sessoinToken not cached but command rejected as token expired\n            // to prevent session openning flood\n            throw new Error('Unexpected session expiration');\n          }\n          debug('Session token expired, reopening');\n          delete internal(this).sessionToken;\n          return this._open(appId, tag, deviceId, isReconnect);\n        }\n        throw error;\n      });\n  }\n\n  /**\n   * 关闭客户端\n   * @return {Promise}\n   */\n  close() {\n    this._debug('close session');\n    const command = new GenericCommand({\n      cmd: 'session',\n      op: 'close',\n    });\n    return this._send(command).then(\n      () => {\n        internal(this)._eventemitter.emit('close', {\n          code: 0,\n        });\n        this.emit('close', {\n          code: 0,\n        });\n      }\n    );\n  }\n  /**\n   * 获取 client 列表中在线的 client，每次查询最多 20 个 clientId，超出部分会被忽略\n   * @param  {String[]} clientIds 要查询的 client ids\n   * @return {Primse.<String[]>} 在线的 client ids\n   */\n  ping(clientIds) {\n    this._debug('ping');\n    if (!(clientIds instanceof Array)) {\n      throw new TypeError(`clientIds ${clientIds} is not an Array`);\n    }\n    if (!clientIds.length) {\n      return Promise.resolve([]);\n    }\n    const command = new GenericCommand({\n      cmd: 'session',\n      op: 'query',\n      sessionMessage: new SessionCommand({\n        sessionPeerIds: clientIds,\n      }),\n    });\n    return this._send(command)\n      .then(resCommand => resCommand.sessionMessage.onlineSessionPeerIds);\n  }\n\n  /**\n   * 获取某个特定的 conversation\n   * @param  {String} id 对话 id，对应 _Conversation 表中的 objectId\n   * @param  {Boolean} [noCache=false] 强制不从缓存中获取\n   * @return {Promise.<Conversation>}\n   */\n  getConversation(id, noCache = false) {\n    if (typeof id !== 'string') {\n      throw new TypeError(`${id} is not a String`);\n    }\n    if (!noCache) {\n      const cachedConversation = this._conversationCache.get(id);\n      if (cachedConversation) {\n        return Promise.resolve(cachedConversation);\n      }\n    }\n    return this\n      .getQuery()\n      .equalTo('objectId', id)\n      .find()\n      .then(conversations => conversations[0] || null);\n  }\n\n  /**\n   * 构造一个 ConversationQuery 来查询对话\n   * @return {ConversationQuery}\n   */\n  getQuery() {\n    return new ConversationQuery(this);\n  }\n\n  _executeQuery(query) {\n    const queryJSON = query.toJSON();\n    queryJSON.where = new JsonObjectMessage({\n      data: JSON.stringify(queryJSON.where),\n    });\n    const command = new GenericCommand({\n      cmd: 'conv',\n      op: 'query',\n      convMessage: new ConvCommand(queryJSON),\n    });\n    return this\n      ._send(command)\n      .then((resCommand) => {\n        try {\n          return JSON.parse(resCommand.convMessage.results.data);\n        } catch (error) {\n          const commandString = JSON.stringify(trim(resCommand));\n          throw new Error(`Parse query result failed: ${error.message}. Command: ${commandString}`);\n        }\n      })\n      .then(conversations => Promise.all(conversations.map(\n        this._parseConversationFromRawData.bind(this)\n      )))\n      .then(conversations => conversations.map((fetchedConversation) => {\n        let conversation = this._conversationCache.get(fetchedConversation.id);\n        if (!conversation) {\n          conversation = fetchedConversation;\n          this._debug('no match, set cache');\n          this._conversationCache.set(fetchedConversation.id, fetchedConversation);\n        } else {\n          this._debug('update cached conversation');\n          [\n            'creator',\n            'createdAt',\n            'updatedAt',\n            'lastMessageAt',\n            'lastMessage',\n            'mutedMembers',\n            'members',\n            '_attributes',\n            'transient',\n            'muted',\n          ].forEach((key) => {\n            const value = fetchedConversation[key];\n            if (value !== undefined) conversation[key] = value;\n          });\n          conversation._reset();\n        }\n        return conversation;\n      }));\n  }\n\n  _parseConversationFromRawData(rawData) {\n    const data = keyRemap({\n      objectId: 'id',\n      lm: 'lastMessageAt',\n      msg: 'lastMessage',\n      msg_from: 'lastMessageFrom',\n      msg_mid: 'lastMessageId',\n      msg_timestamp: 'lastMessageTimestamp',\n      m: 'members',\n      tr: 'transient',\n      sys: 'system',\n      c: 'creator',\n      mu: 'mutedMembers',\n    }, rawData);\n    return Promise.resolve().then(() => {\n      if (data.lastMessage) {\n        return this._messageParser.parse(data.lastMessage).then(\n          (message) => {\n            data.lastMessage = message;\n            data.lastMessage.from = data.lastMessageFrom;\n            data.lastMessage.id = data.lastMessageId;\n            data.lastMessage.timestamp = new Date(data.lastMessageTimestamp);\n            data.lastMessage._setStatus(MessageStatus.SENT);\n            delete data.lastMessageFrom;\n            delete data.lastMessageId;\n            delete data.lastMessageTimestamp;\n          }\n        );\n      }\n      return Promise.resolve();\n    }).then(() => new Conversation(data, this));\n  }\n\n  /**\n   * 创建一个 conversation\n   * @param {Object} options 除了下列字段外的其他字段将被视为对话的自定义属性\n   * @param {String[]} options.members 对话的初始成员列表，默认包含当前 client\n   * @param {String} [options.name] 对话的名字\n   * @param {Object} [options.attributes] DEPRECATED: 额外属性，对应 _Conversation 表的 attr 列\n   * @param {Boolean} [options.transient=false] 暂态会话\n   * @param {Boolean} [options.unique=false] 唯一对话，当其为 true 时，如果当前已经有相同成员的对话存在则返回该对话，否则会创建新的对话\n   * @return {Promise.<Conversation>}\n   */\n  createConversation(options = {}) {\n    const {\n      members: m,\n      name,\n      attributes,\n      transient,\n      unique,\n      ...properties,\n    } = options;\n    if (!(transient || Array.isArray(m))) {\n      throw new TypeError(`conversation members ${m} is not an array`);\n    }\n    let members = new Set(m);\n    members.add(this.id);\n    members = Array.from(members).sort();\n    let attr = properties || {};\n    if (name) {\n      if (typeof name !== 'string') {\n        throw new TypeError(`conversation name ${name} is not a string`);\n      }\n      attr.name = name;\n    }\n    if (attributes) {\n      console.warn('DEPRECATION createConversation options.attributes param: Use options[propertyName] instead. See https://url.leanapp.cn/DeprecateAttributes for more details.');\n      attr.attr = attributes;\n    }\n    attr = new JsonObjectMessage({\n      data: JSON.stringify(attr),\n    });\n\n    const startCommandJson = {\n      m: members,\n      attr,\n      transient,\n      unique,\n    };\n\n    return Promise.resolve(\n        new GenericCommand({\n          cmd: 'conv',\n          op: 'start',\n          convMessage: new ConvCommand(startCommandJson),\n        })\n      )\n      .then((command) => {\n        if (this.options.conversationSignatureFactory) {\n          const params = [null, this.id, members, 'create'];\n          return runSignatureFactory(this.options.conversationSignatureFactory, params)\n            .then((signatureResult) => {\n              Object.assign(command.convMessage, keyRemap({\n                signature: 's',\n                timestamp: 't',\n                nonce: 'n',\n              }, signatureResult));\n              return command;\n            });\n        }\n        return command;\n      })\n      .then(this._send.bind(this))\n      .then(resCommand => new Conversation({\n        name,\n        attr: attributes,\n        transient,\n        unique,\n        id: resCommand.convMessage.cid,\n        createdAt: resCommand.convMessage.cdate,\n        updatedAt: resCommand.convMessage.cdate,\n        lastMessageAt: null,\n        creator: this.id,\n        members: transient ? [] : members,\n        ...properties,\n      }, this))\n      .then(tap(conversation =>\n        this._conversationCache.set(conversation.id, conversation)\n      ));\n  }\n\n  /**\n   * 将指定的所有会话标记为已读\n   *\n   * @param {Conversation[]} conversations 指定的会话列表\n   * @return {Promise.<Conversation[]>} conversations 返回输入的会话列表\n   */\n  markAllAsRead(conversations) {\n    if (!Array.isArray(conversations)) {\n      throw new TypeError(`${conversations} is not an Array`);\n    }\n    const ids = conversations.map((conversation) => {\n      if (!(conversation instanceof Conversation)) {\n        throw new TypeError(`${conversation} is not a Conversation`);\n      }\n      return conversation.id;\n    });\n    this._debug(`mark [${ids}] as read`);\n    if (!conversations.length) {\n      return Promise.resolve([]);\n    }\n    return this._send(new GenericCommand({\n      cmd: 'read',\n      readMessage: new ReadCommand({\n        convs: conversations.map(conversation => new ReadTuple({\n          cid: conversation.id,\n          timestamp: (conversation.lastMessageAt || new Date()).getTime(),\n        })),\n      }),\n    }), false).then(() => {\n      // eslint-disable-next-line no-param-reassign\n      conversations.forEach(conversation => (conversation.unreadMessagesCount = 0));\n      return conversations;\n    });\n  }\n}\n","import EventEmitter from 'eventemitter3';\nimport isEmpty from 'lodash/isEmpty';\nimport isPlainObject from 'lodash/isPlainObject';\nimport cloneDeep from 'lodash/cloneDeep';\nimport { default as d } from 'debug';\nimport { decodeDate, keyRemap, union, difference, internal, setValue } from './utils';\nimport { applyDecorators } from './plugin';\nimport IMClient from './im-client';\nimport {\n  GenericCommand,\n  ConvCommand,\n  JsonObjectMessage,\n  DirectCommand,\n  LogsCommand,\n} from '../proto/message';\nimport runSignatureFactory from './signature-factory-runner';\nimport { createError } from './error';\nimport Message, { MessageStatus } from './messages/message';\n\nconst debug = d('LC:Conversation');\n\nexport default class Conversation extends EventEmitter {\n  /**\n   * 无法直接实例化，请使用 {@link IMClient#createConversation} 创建新的对话\n   * @extends EventEmitter\n   */\n  constructor({\n    id,\n    creator,\n    createdAt,\n    updatedAt,\n    lastMessageAt,\n    lastMessage,\n    mutedMembers = [],\n    members = [],\n    transient = false,\n    system = false,\n    muted = false,\n    // jsdoc-ignore-start\n    ...attributes,\n    // jsdoc-ignore-end\n  }, client) {\n    super();\n    Object.assign(this, {\n      /**\n       * 对话 id，对应 _Conversation 表中的 objectId\n       * @memberof Conversation#\n       * @type {String}\n       */\n      id,\n      /**\n       * 对话创建者\n       * @memberof Conversation#\n       * @type {String}\n       */\n      creator,\n      /**\n       * 对话创建时间\n       * @memberof Conversation#\n       * @type {Date}\n       */\n      createdAt,\n      /**\n       * 对话更新时间\n       * @memberof Conversation#\n       * @type {Date}\n       */\n      updatedAt,\n      /**\n       * 最后一条消息时间\n       * @memberof Conversation#\n       * @type {Date}\n       */\n      lastMessageAt,\n      /**\n       * 最后一条消息\n       * @memberof Conversation#\n       * @type {?Message}\n       */\n      lastMessage,\n      /**\n       * 对该对话设置了静音的用户列表\n       * @memberof Conversation#\n       * @type {?String[]}\n       */\n      mutedMembers,\n      /**\n       * 参与该对话的用户列表\n       * @memberof Conversation#\n       * @type {String[]}\n       */\n      members,\n      /**\n       * 暂态对话标记\n       * @memberof Conversation#\n       * @type {Boolean}\n       */\n      transient,\n      /**\n       * 系统对话标记\n       * @memberof Conversation#\n       * @type {Boolean}\n       * @since 3.3\n       */\n      system,\n      /**\n       * 当前用户静音该对话标记\n       * @memberof Conversation#\n       * @type {Boolean}\n       */\n      muted,\n    });\n    this._attributes = attributes;\n    this._reset();\n    /**\n     * 当前用户在该对话的未读消息数\n     * @memberof Conversation#\n     * @type {Number}\n     */\n    this.unreadMessagesCount = 0;\n    this.members = Array.from(new Set(this.members));\n    internal(this).messagesWaitingForReciept = {};\n    if (client instanceof IMClient) {\n      this._client = client;\n    } else {\n      throw new TypeError('Conversation must be initialized with a client');\n    }\n    [\n      'kicked',\n      'membersjoined',\n      'membersleft',\n      'membersstatuschange',\n      'message',\n    ].forEach(event => this.on(\n      event,\n      (...payload) => this._debug(`${event} event emitted.`, ...payload)\n    ));\n    // onConversationCreate hook\n    applyDecorators(this._client._plugins.onConversationCreate, this);\n  }\n\n  set createdAt(value) {\n    this._createdAt = decodeDate(value);\n  }\n  get createdAt() {\n    return this._createdAt;\n  }\n  set updatedAt(value) {\n    this._updatedAt = decodeDate(value);\n  }\n  get updatedAt() {\n    return this._updatedAt;\n  }\n  set lastMessageAt(value) {\n    this._lastMessageAt = decodeDate(value);\n  }\n  get lastMessageAt() {\n    return this._lastMessageAt;\n  }\n\n  /**\n   * 对话额外属性，对应 _Conversation 表中的 attr\n   * @type {Object}\n   * @deprecated Use {@link Conversation#get conversation.get('attr')},\n   * {@link Conversation#set conversation.set('attr', value)} instead\n   */\n  get attributes() {\n    console.warn('DEPRECATION Conversation.attributes: Use conversation.get(\\'attr\\') instead. See https://url.leanapp.cn/DeprecateAttributes for more details.');\n    return this.get('attr');\n  }\n  set attributes(value) {\n    console.warn('DEPRECATION Conversation.attributes: Use conversation.set(\\'attr\\', value) instead. See https://url.leanapp.cn/DeprecateAttributes for more details.');\n    this.set('attr', value);\n  }\n  /**\n   * 设置对话额外属性\n   * @param {Object} map    key-value 对\n   * @param {Boolean} [assign=false] 使用 Object.assign 更新属性，而不是替换整个 attributes\n   * @return {Conversation} self\n   * @deprecated Use {@link Conversation#set} instead. See {@link https://url.leanapp.cn/DeprecateAttributes} for more details.\n   */\n  setAttributes(map, assign = false) {\n    console.warn('DEPRECATION Conversation#setAttributes: Use conversation.set() instead. See https://url.leanapp.cn/DeprecateAttributes for more details.');\n    this._debug(`set attributes: value=${JSON.stringify(map)}, assign=${assign}`);\n    if (!isPlainObject(map)) {\n      throw new TypeError('attributes must be a plain object');\n    }\n    if (!assign) {\n      this.set('attr', map);\n    } else {\n      Object.keys(map).forEach(key => this.setAttribute(key, map[key]));\n    }\n    return this;\n  }\n  /**\n   * 设置对话额外属性\n   * @param {String} key\n   * @param {Any} value\n   * @return {Conversation} self\n   * @deprecated Use {@link Conversation#set conversation.set('attr.key', value)} instead\n   */\n  setAttribute(key, value) {\n    console.warn('DEPRECATION Conversation#setAttribute: Use conversation.set(\\'attr.key\\', value) instead. See https://url.leanapp.cn/DeprecateAttributes for more details.');\n    return this.set(`attr.${key}`, value);\n  }\n  /**\n   * 对话名字，对应 _Conversation 表中的 name\n   * @type {String}\n   */\n  get name() {\n    return this.get('name');\n  }\n  set name(value) {\n    this.set('name', value);\n  }\n  /**\n   * 设置对话名字\n   * @param {String} value\n   * @return {Conversation} self\n   * @deprecated Use {@link Conversation#set conversation.set('name', value)} instead\n   */\n  setName(value) {\n    console.warn('DEPRECATION Conversation#setName: Use conversation.set(\\'name\\', value) instead. See https://url.leanapp.cn/DeprecateAttributes for more details.');\n    return this.set('name', value);\n  }\n\n  /**\n   * 获取对话的自定义属性\n   * @since 3.2.0\n   * @param  {String} key key 属性的键名，'x' 对应 Conversation 表中的 x 列\n   * @return {Any} 属性的值\n   */\n  get(key) {\n    return internal(this).currentAttributes[key];\n  }\n\n  /**\n   * 设置对话的自定义属性\n   * @since 3.2.0\n   * @param {String} key 属性的键名，'x' 对应 Conversation 表中的 x 列，支持使用 'x.y.z' 来修改对象的部分字段。\n   * @param {Any} value 属性的值\n   * @return {Conversation} self\n   * @example\n   *\n   * // 设置对话的 color 属性\n   * conversation.set('color', {\n   *   text: '#000',\n   *   background: '#DDD',\n   * });\n   * // 设置对话的 color.text 属性\n   * conversation.set('color.text', '#333');\n   */\n  set(key, value) {\n    this._debug(`set [${key}]: ${value}`);\n    const pendingAttributes = internal(this).pendingAttributes;\n    const pendingKeys = Object.keys(pendingAttributes);\n    // suppose pendingAttributes = { 'a.b': {} }\n    // set 'a' or 'a.b': delete 'a.b'\n    const re = new RegExp(`^${key}`);\n    const childKeys = pendingKeys.filter(re.test.bind(re));\n    childKeys.forEach((k) => {\n      delete pendingAttributes[k];\n    });\n    if (childKeys.length) {\n      pendingAttributes[key] = value;\n    } else {\n      // set 'a.c': nothing to do\n      // set 'a.b.c.d': assign c: { d: {} } to 'a.b'\n      // CAUTION: non-standard API, provided by core-js\n      const parentKey = Array.find(pendingKeys, k => key.indexOf(k) === 0); // 'a.b'\n      if (parentKey) {\n        setValue(pendingAttributes[parentKey], key.slice(parentKey.length + 1), value);\n      } else {\n        pendingAttributes[key] = value;\n      }\n    }\n    // build currentAttributes\n    internal(this).currentAttributes = Object.keys(pendingAttributes)\n      .reduce(\n        (target, k) => setValue(target, k, pendingAttributes[k]),\n        cloneDeep(this._attributes)\n      );\n    return this;\n  }\n\n  _reset() {\n    internal(this).pendingAttributes = {};\n    internal(this).currentAttributes = this._attributes;\n  }\n\n  _debug(...params) {\n    debug(...params, `[${this.id}]`);\n  }\n\n  _send(command, ...args) {\n    /* eslint-disable no-param-reassign */\n    if (command.cmd === null) {\n      command.cmd = 'conv';\n    }\n    if (command.cmd === 'conv' && command.convMessage === null) {\n      command.convMessage = new ConvCommand();\n    }\n    if (command.convMessage && command.convMessage.cid === null) {\n      command.convMessage.cid = this.id;\n    }\n    /* eslint-enable no-param-reassign */\n    return this._client._send(command, ...args);\n  }\n  /**\n   * 保存当前对话的属性至服务器\n   * @return {Promise.<Conversation>} self\n   */\n  save() {\n    this._debug('save');\n    const attr = internal(this).pendingAttributes;\n    if (isEmpty(attr)) {\n      this._debug('nothing touched, resolve with self');\n      return Promise.resolve(this);\n    }\n    this._debug(`attr: ${JSON.stringify(attr)}`);\n    const convMessage = new ConvCommand({\n      attr: new JsonObjectMessage({\n        data: JSON.stringify(attr),\n      }),\n    });\n    return this\n      ._send(new GenericCommand({\n        op: 'update',\n        convMessage,\n      }))\n      .then((resCommand) => {\n        this.updatedAt = resCommand.convMessage.udate;\n        this._attributes = internal(this).currentAttributes;\n        internal(this).pendingAttributes = {};\n        return this;\n      });\n  }\n\n  /**\n   * 从服务器更新对话的属性\n   * @return {Promise.<Conversation>} self\n   */\n  fetch() {\n    return this\n      ._client\n      .getQuery()\n      .equalTo('objectId', this.id)\n      .find()\n      .then(() => this);\n  }\n\n  /**\n   * 静音，客户端拒绝收到服务器端的离线推送通知\n   * @return {Promise.<Conversation>} self\n   */\n  mute() {\n    this._debug('mute');\n    return this._send(new GenericCommand({\n      op: 'mute',\n    })).then(() => {\n      if (!this.transient) {\n        this.muted = true;\n        this.mutedMembers = union(this.mutedMembers, [this._client.id]);\n      }\n      return this;\n    });\n  }\n\n  /**\n   * 取消静音\n   * @return {Promise.<Conversation>} self\n   */\n  unmute() {\n    this._debug('unmute');\n    return this._send(new GenericCommand({\n      op: 'unmute',\n    })).then(() => {\n      if (!this.transient) {\n        this.muted = false;\n        this.mutedMembers = difference(this.mutedMembers, [this._client.id]);\n      }\n      return this;\n    });\n  }\n\n  /**\n   * 获取对话人数，或暂态对话的在线人数\n   * @return {Promise.<Number>}\n   */\n  count() {\n    this._debug('unmute');\n    return this._send(new GenericCommand({\n      op: 'count',\n    })).then(resCommand => resCommand.convMessage.count);\n  }\n\n  /**\n   * 增加成员\n   * @param {String|String[]} clientIds 新增成员 client id\n   * @return {Promise.<Conversation>} self\n   */\n  add(clientIds) {\n    this._debug('add', clientIds);\n    if (typeof clientIds === 'string') {\n      clientIds = [clientIds]; // eslint-disable-line no-param-reassign\n    }\n    const convMessage = new ConvCommand({\n      m: clientIds,\n    });\n    return Promise.resolve(\n      new GenericCommand({\n        op: 'add',\n        convMessage,\n      })\n    ).then((command) => {\n      if (this._client.options.conversationSignatureFactory) {\n        const params = [this.id, this._client.id, clientIds.sort(), 'add'];\n        return runSignatureFactory(this._client.options.conversationSignatureFactory, params)\n          .then((signatureResult) => {\n            Object.assign(command.convMessage, keyRemap({\n              signature: 's',\n              timestamp: 't',\n              nonce: 'n',\n            }, signatureResult));\n            return command;\n          });\n      }\n      return command;\n    }).then(\n      this._send.bind(this)\n    ).then(() => {\n      if (!this.transient && !this.system) {\n        this.members = union(this.members, clientIds);\n      }\n      return this;\n    });\n  }\n\n  /**\n   * 剔除成员\n   * @param {String|String[]} clientIds 成员 client id\n   * @return {Promise.<Conversation>} self\n   */\n  remove(clientIds) {\n    this._debug('remove', clientIds);\n    if (typeof clientIds === 'string') {\n      clientIds = [clientIds]; // eslint-disable-line no-param-reassign\n    }\n    const convMessage = new ConvCommand({\n      m: clientIds,\n    });\n    return Promise.resolve(\n      new GenericCommand({\n        op: 'remove',\n        convMessage,\n      })\n    ).then((command) => {\n      if (this._client.options.conversationSignatureFactory) {\n        const params = [this.id, this._client.id, clientIds.sort(), 'remove'];\n        return runSignatureFactory(this._client.options.conversationSignatureFactory, params)\n          .then((signatureResult) => {\n            Object.assign(command.convMessage, keyRemap({\n              signature: 's',\n              timestamp: 't',\n              nonce: 'n',\n            }, signatureResult));\n            return command;\n          });\n      }\n      return command;\n    }).then(\n      this._send.bind(this)\n    ).then(() => {\n      if (!this.transient && !this.system) {\n        this.members = difference(this.members, clientIds);\n      }\n      return this;\n    });\n  }\n\n  /**\n   * （当前用户）加入该对话\n   * @return {Promise.<Conversation>} self\n   */\n  join() {\n    this._debug('join');\n    return this.add(this._client.id);\n  }\n\n  /**\n   * （当前用户）退出该对话\n   * @return {Promise.<Conversation>} self\n   */\n  quit() {\n    this._debug('quit');\n    return this.remove(this._client.id);\n  }\n\n  /**\n   * 发送消息\n   * @param  {Message} message 消息，Message 及其子类的实例\n   * @return {Promise.<Message>} 发送的消息\n   */\n  send(message) {\n    this._debug(message, 'send');\n    if (!(message instanceof Message)) {\n      throw new TypeError(`${message} is not a Message`);\n    }\n    if (message.needReceipt) {\n      if (this.transient) {\n        console.warn('message needReceipt option is ignored as the conversation is transient.');\n      } else if (message.transient) {\n        console.warn('message needReceipt option is ignored as the message is transient.');\n      } else if (this.members.length > 2) {\n        console.warn('message with needReceipt option is recommended to be sent in one-on-one conversation.'); // eslint-disable-line max-len\n      }\n    }\n    Object.assign(message, {\n      cid: this.id,\n      from: this._client.id,\n    });\n    message._setStatus(MessageStatus.SENDING);\n    let msg = message.toJSON();\n    if (typeof msg !== 'string') {\n      msg = JSON.stringify(msg);\n    }\n    let sendPromise = this._send(new GenericCommand({\n      cmd: 'direct',\n      directMessage: new DirectCommand({\n        msg,\n        cid: this.id,\n        r: message.needReceipt,\n        transient: message.transient,\n        dt: message.id,\n      }),\n    }), !message.transient);\n    if (!message.transient) {\n      sendPromise = sendPromise.then((resCommand) => {\n        const {\n          ackMessage: {\n            uid,\n            t,\n            code,\n            reason,\n            appCode,\n            },\n          } = resCommand;\n        if (code !== null) {\n          throw createError({\n            code, reason, appCode,\n          });\n        }\n        Object.assign(message, {\n          id: uid,\n          timestamp: new Date(t.toNumber()),\n        });\n        this.lastMessage = message;\n        this.lastMessageAt = message.timestamp;\n      });\n    }\n    return sendPromise.then(() => {\n      message._setStatus(MessageStatus.SENT);\n      if (message.needReceipt) {\n        internal(this).messagesWaitingForReciept[message.id] = message;\n      }\n      return message;\n    }, (error) => {\n      message._setStatus(MessageStatus.FAILED);\n      throw error;\n    });\n  }\n\n  /**\n   * 查询消息记录\n   * 如果仅需实现消息记录翻页查询需求，建议使用 {@link Conversation#createMessagesIterator}\n   * @param  {Object} [options]\n   * @param  {Date}   [options.beforeTime] 限制查询结果为小于这个该时间之前的消息，不传则为当前时间\n   * @param  {String} [options.beforeMessageId] 限制查询结果为该消息之前的消息，需要与 beforeTime 同时使用，为防止某时刻有重复消息\n   * @param  {Date}   [options.afterTime] 限制查询结果为大于这个该时间之前的消息\n   * @param  {String} [options.afterMessageId] 限制查询结果为该消息之后的消息，需要与 afterTime 同时使用，为防止某时刻有重复消息\n   * @param  {Number} [options.limit] 限制查询结果的数量，目前服务端默认为 20\n   * @return {Promise.<Message[]>} 消息列表\n   */\n  queryMessages(options = {}) {\n    this._debug('query messages', options);\n    if (options.beforeMessageId && !options.beforeTime) {\n      throw new Error('query option beforeMessageId must be used with option beforeTime');\n    }\n    if (options.afterMessageId && !options.afterTime) {\n      throw new Error('query option afterMessageId must be used with option afterTime');\n    }\n    const conditions = keyRemap({\n      beforeTime: 't',\n      beforeMessageId: 'mid',\n      afterTime: 'tt',\n      afterMessageId: 'tmid',\n      limit: 'l',\n    }, options);\n    if (conditions.t instanceof Date) {\n      conditions.t = conditions.t.getTime();\n    }\n    if (conditions.tt instanceof Date) {\n      conditions.tt = conditions.tt.getTime();\n    }\n    return this._send(new GenericCommand({\n      cmd: 'logs',\n      logsMessage: new LogsCommand(\n        Object.assign(conditions, {\n          cid: this.id,\n        })\n      ),\n    })).then(resCommand =>\n      Promise.all(resCommand.logsMessage.logs.map(log =>\n        this._client._messageParser.parse(log.data).then((message) => {\n          const messageProps = {\n            id: log.msgId,\n            cid: this.id,\n            timestamp: new Date(log.timestamp.toNumber()),\n            from: log.from,\n          };\n          Object.assign(message, messageProps);\n          message._setStatus(MessageStatus.SENT);\n          return message;\n        })\n      ))\n    );\n  }\n\n  /**\n   * 获取消息翻页迭代器\n   * @param  {Object} [options]\n   * @param  {Date}   [options.beforeTime] 限制起始查询结果为小于这个该时间之前的消息，不传则为当前时间\n   * @param  {String} [options.beforeMessageId] 限制起始查询结果为该消息之前的消息，需要与 beforeTime 同时使用，为防止某时刻有重复消息\n   * @param  {Number} [options.limit] 限制每页查询结果的数量，目前服务端默认为 20\n   * @return {AsyncIterater.<Promise.<IteratorResult<Message[]>>>} [AsyncIterator]{@link https://github.com/tc39/proposal-async-iteration}，调用其 next 方法返回获取下一页消息的 Promise\n   * @example\n   * var messageIterator = conversation.createMessagesIterator({ limit: 10 });\n   * messageIterator.next().then(function(result) {\n   *   // result: {\n   *   //   value: [message1, ..., message10],\n   *   //   done: false,\n   *   // }\n   * });\n   * messageIterator.next().then(function(result) {\n   *   // result: {\n   *   //   value: [message11, ..., message20],\n   *   //   done: false,\n   *   // }\n   * });\n   * messageIterator.next().then(function(result) {\n   *   // No more messages\n   *   // result: { value: [], done: true }\n   * });\n   */\n  createMessagesIterator({ beforeTime, beforeMessageId, limit } = {}) {\n    let promise;\n    return {\n      next: () => {\n        if (promise === undefined) {\n          // first call\n          promise = this.queryMessages({\n            limit,\n            beforeTime,\n            beforeMessageId,\n          });\n        } else {\n          promise = promise.then((prevMessages) => {\n            if (prevMessages.length === 0 || prevMessages.length < limit) {\n              // no more messages\n              return [];\n            }\n            return this.queryMessages({\n              beforeTime: prevMessages[0].timestamp,\n              beforeMessageId: prevMessages[0].id,\n              limit,\n            });\n          });\n        }\n        return promise.then(value => ({\n          value: Array.from(value),\n          done: value.length === 0 || value.length < limit,\n        }));\n      },\n    };\n  }\n\n  /**\n   * 将该会话标记为已读\n   * @return {Promise.<Conversation>} self\n   */\n  markAsRead() {\n    return this._client.markAllAsRead([this]).then(() => this);\n  }\n\n  _handleReceipt({ messageId, deliveredAt }) {\n    const { messagesWaitingForReciept } = internal(this);\n    const message = messagesWaitingForReciept[messageId];\n    delete messagesWaitingForReciept[messageId];\n    if (!message) return;\n    message._setStatus(MessageStatus.DELIVERED);\n    message.deliveredAt = deliveredAt;\n    /**\n     * 消息已送达。只有在发送时设置了需要回执的情况下才会收到送达回执，该回执并不代表用户已读。\n     * @event Conversation#receipt\n     * @since 3.2.0\n     * @param {Object} payload\n     * @param {Message} payload.message 送达的消息\n     */\n    this.emit('receipt', { message });\n  }\n\n  /**\n   * 更新会话的上下线通知策略\n   * @param {Object} [options]\n   * @param {Boolean} [options.pub = false] 是否公开自己的上下线状态\n   * @param {Boolean} [options.sub = false] 是否订阅该会话其他成员公开的上下线状态\n   * @param {Number} [options.ttl] 下线后保留该策略的时间，单位为秒\n   */\n  updateOnlineStatusPolicy({\n    pub = false,\n    sub = false,\n    ttl,\n  }) {\n    this._debug('updateOnlineStatusPolicy', pub, sub, ttl);\n    const convMessage = new ConvCommand({\n      statusPub: pub,\n      statusSub: sub,\n      statusTTL: ttl,\n    });\n    const command = new GenericCommand({\n      op: 'status',\n      convMessage,\n    });\n    return this._send(command);\n  }\n}\n","import { default as d } from 'debug';\nimport isPlainObject from 'lodash/isPlainObject';\nimport { applyMiddlewares } from './plugin';\n\nconst debug = d('LC:MessageParser');\n\nconst tryParseJson = (target, key, descriptor) => {\n  const fn = descriptor.value;\n  // eslint-disable-next-line no-param-reassign\n  descriptor.value = function wrapper(param) {\n    let content;\n    if (typeof param !== 'string') {\n      content = param;\n    } else {\n      try {\n        content = JSON.parse(param);\n      } catch (error) {\n        content = param;\n      }\n    }\n    return fn.call(this, content);\n  };\n};\n\nconst applyPlugins = (target, key, descriptor) => {\n  const fn = descriptor.value;\n  // eslint-disable-next-line no-param-reassign\n  descriptor.value = function wrapper(json) {\n    return Promise.resolve(json)\n      .then(applyMiddlewares(this._plugins.beforeMessageParse))\n      .then(decoratedJson => fn.call(this, decoratedJson))\n      .then(applyMiddlewares(this._plugins.afterMessageParse));\n  };\n};\n\nexport default class MessageParser {\n  constructor(plugins = {}) {\n    this._plugins = plugins;\n    this._messageClasses = [];\n  }\n\n  register(messageClass) {\n    if (\n      messageClass &&\n      messageClass.parse &&\n      messageClass.prototype &&\n      messageClass.prototype.toJSON\n    ) {\n      this._messageClasses.unshift(messageClass);\n    } else {\n      throw new TypeError('Invalid messageClass');\n    }\n  }\n\n  // jsdoc-ignore-start\n  @tryParseJson\n  @applyPlugins\n  // jsdoc-ignore-end\n  parse(content) {\n    debug('parsing message:', content);\n    for (const Klass of this._messageClasses) {\n      const contentCopy = isPlainObject(content) ? Object.assign({}, content) : content;\n      let valid;\n      let result;\n      try {\n        valid = Klass.validate(contentCopy);\n      } catch (error) {\n        // eslint-disable-line no-empty\n      }\n      if (valid) {\n        try {\n          result = Klass.parse(contentCopy);\n        } catch (error) {\n          console.warn('parsing a valid message content error', {\n            error,\n            Klass,\n            content: contentCopy,\n          });\n        }\n        if (result !== undefined) {\n          debug('parse result:', result);\n          return result;\n        }\n      }\n    }\n    throw new Error('No Message Class matched');\n  }\n}\n","/* eslint-disable no-param-reassign */\nimport { getStaticProperty, isIE10 } from '../utils';\n\n// documented in ../index.js\nexport const messageType = (type) => {\n  if (typeof type !== 'number') {\n    throw new TypeError(`${type} is not a Number`);\n  }\n  return (target) => {\n    target.TYPE = type;\n    target.validate = json => (json._lctype === type);\n    target.prototype._getType = () => ({ _lctype: type });\n  };\n};\n\n// documented in ../index.js\nexport const messageField = (fields) => {\n  if (typeof fields !== 'string') {\n    if (!Array.isArray(fields)) {\n      throw new TypeError(`${fields} is not an Array`);\n    } else if (fields.some(value => typeof value !== 'string')) {\n      throw new TypeError('fields contains non-string typed member');\n    }\n  }\n  return (target) => {\n    // IE10 Hack:\n    // static properties in IE10 will not be inherited from super\n    // search for parse method and assign it manually\n    let originalCustomFields = isIE10\n      ? getStaticProperty(target, '_customFields')\n      : target._customFields;\n    originalCustomFields = Array.isArray(originalCustomFields)\n      ? originalCustomFields : [];\n    target._customFields = originalCustomFields.concat(fields);\n  };\n};\n\n// IE10 Hack:\n// static properties in IE10 will not be inherited from super\n// search for parse method and assign it manually\n\nexport const IE10Compatible = (target) => {\n  if (isIE10) {\n    target.parse = getStaticProperty(target, 'parse');\n  }\n};\n","import Message from './message';\nimport { messageField } from './helpers';\nimport { getStaticProperty, isIE10 } from '../utils';\n\n// jsdoc-ignore-start\n@messageField(['_lctext', '_lcattrs'])\n// jsdoc-ignore-end\nexport default class TypedMessage extends Message {\n  /**\n   * 所有内置的富媒体消息均继承自本类\n   * @extends Message\n   */\n  constructor() {\n    super();\n    this._ = {};\n  }\n\n  /**\n   * @type {Number}\n   * @readonly\n   */\n  get type() {\n    return this.constructor.TYPE;\n  }\n\n  /** @type {String} */\n  set text(text) {\n    return this.setText(text);\n  }\n  get text() {\n    return this.getText();\n  }\n\n  /** @type {Object} */\n  set attributes(attributes) {\n    return this.setAttributes(attributes);\n  }\n  get attributes() {\n    return this.getAttributes();\n  }\n\n  /**\n   * @param {String} text\n   * @return {TypedMessage} self\n   */\n  setText(text) {\n    this._lctext = text;\n    return this;\n  }\n  /**\n   * @return {String}\n   */\n  getText() {\n    return this._lctext;\n  }\n\n  /**\n   * @param {Object} attributes\n   * @return {TypedMessage} self\n   */\n  setAttributes(attributes) {\n    this._lcattrs = attributes;\n    return this;\n  }\n  /**\n   * @return {Object}\n   */\n  getAttributes() {\n    return this._lcattrs;\n  }\n\n  _getCustomFields() {\n    const fields = Array.isArray(this.constructor._customFields)\n      ? this.constructor._customFields : [];\n    return fields.reduce((result, field) => {\n      if (typeof field !== 'string') return result;\n      result[field] = this[field]; // eslint-disable-line no-param-reassign\n      return result;\n    }, {});\n  }\n\n  /* eslint-disable class-methods-use-this */\n  _getType() {\n    throw new Error('not implemented');\n  }\n  /* eslint-enable class-methods-use-this */\n\n  toJSON() {\n    return Object.assign({\n      _lctext: this.getText(),\n      _lcattrs: this.getAttributes(),\n    }, this._getCustomFields(), this._getType());\n  }\n\n  /**\n   * 解析处理消息内容\n   * <pre>\n   * 为给定的 message 设置 text 与 attributes 属性，返回该 message\n   * 如果子类没有提供 message，new this()\n   * @protected\n   * @param  {Object}  json    json 格式的消息内容\n   * @param  {TypedMessage} message 子类提供的 message\n   * @return {TypedMessage}\n   * @implements AVMessage.parse\n   */\n  static parse(json, message = new this()) {\n    message.content = json; // eslint-disable-line no-param-reassign\n    const customFields = isIE10\n      ? getStaticProperty(message.constructor, '_customFields')\n      : message.constructor._customFields;\n    let fields = Array.isArray(customFields) ? customFields : [];\n    fields = fields.reduce((result, field) => {\n      if (typeof field !== 'string') return result;\n      result[field] = json[field]; // eslint-disable-line no-param-reassign\n      return result;\n    }, {});\n    Object.assign(message, fields);\n    return super.parse(json, message);\n  }\n}\n","import TypedMessage from './typed-message';\nimport { messageType, IE10Compatible } from './helpers';\n\n// jsdoc-ignore-start\n@messageType(-1)\n@IE10Compatible\n// jsdoc-ignore-end\nexport default class TextMessage extends TypedMessage {\n  /**\n   * 文类类型消息\n   * @extends TypedMessage\n   * @param  {String} [text='']\n   * @throws {TypeError} text 不是 String 类型\n   */\n  constructor(text = '') {\n    if (typeof text !== 'string') {\n      throw new TypeError(`${text} is not a string`);\n    }\n    super();\n    this.setText(text);\n  }\n}\n\n/**\n * @name TYPE\n * @memberof TextMessage\n * @type Number\n * @static\n * @const\n */\n","import { default as d } from 'debug';\nimport EventEmitter from 'eventemitter3';\nimport axios from 'axios';\nimport uuid from 'uuid';\nimport Connection from './connection';\nimport { ErrorCode, createError } from './error';\nimport { tap, Cache, trim, internal, ensureArray } from './utils';\nimport { applyDecorators } from './plugin';\nimport Conversation from './conversation';\nimport Client from './client';\nimport IMClient from './im-client';\nimport MessageParser from './message-parser';\nimport Message from './messages/message';\nimport TextMessage from './messages/text-message';\n\nconst debug = d('LC:Realtime');\n\nconst pushRouterCache = new Cache('push-router');\n\nexport default class Realtime extends EventEmitter {\n  /**\n   * @extends EventEmitter\n   * @param  {Object} options\n   * @param  {String} options.appId\n   * @param  {String} [options.region='cn'] 节点 id\n   * @param  {Boolean} [options.pushOfflineMessages=false] 启用推送离线消息模式（默认为发送未读消息通知模式）\n   * @param  {Boolean} [options.noBinary=false] 设置 WebSocket 使用字符串格式收发消息（默认为二进制格式）。\n   *                                            适用于 WebSocket 实现不支持二进制数据格式的情况（如 React Native）\n   * @param  {Boolean} [options.ssl=true] 使用 wss 进行连接\n   * @param  {Plugin[]} [options.plugins] 加载插件（since 3.1.0）\n   */\n  constructor(options) {\n    debug('initializing Realtime');\n    super();\n    if (typeof options.appId !== 'string') {\n      throw new TypeError(`appId [${options.appId}] is not a string`);\n    }\n    this._options = Object.assign({\n      appId: undefined,\n      region: 'cn',\n      pushOfflineMessages: false,\n      ssl: true,\n    }, options);\n    this._id = uuid.v4();\n    this._cache = new Cache('endpoints');\n    this._clients = {};\n    this._plugins = ensureArray(options.plugins).reduce(\n      (result, plugin) => {\n        // eslint-disable-next-line no-restricted-syntax\n        for (const hook in plugin) {\n          if ({}.hasOwnProperty.call(plugin, hook) && hook !== 'name') {\n            if (plugin.name) {\n              ensureArray(plugin[hook]).forEach((value) => {\n                // eslint-disable-next-line no-param-reassign\n                value._pluginName = plugin.name;\n              });\n            }\n            // eslint-disable-next-line no-param-reassign\n            result[hook] = ensureArray(result[hook]).concat(plugin[hook]);\n          }\n        }\n        return result;\n      },\n      {}\n    );\n    this._messageParser = new MessageParser(this._plugins);\n    this.register([\n      Message,\n      TextMessage,\n    ]);\n    // onRealtimeCreate hook\n    applyDecorators(this._plugins.onRealtimeCreate, this);\n    // messageClasses alias\n    this.register(ensureArray(this._plugins.messageClasses));\n  }\n\n  _open() {\n    if (this._openPromise) return this._openPromise;\n\n    let format = 'protobuf';\n    if (this._options.noBinary) {\n      // 不发送 binary data，fallback to base64 string\n      format = 'protobase64';\n    }\n    let version = 3;\n    if (this._options.pushOfflineMessages) {\n      // 不推送离线消息，而是发送对话的未读通知\n      version = 1;\n    }\n    const protocol = {\n      format,\n      version,\n    };\n    this._openPromise = new Promise((resolve, reject) => {\n      debug('No connection established, create a new one.');\n      const connection = new Connection(\n        () => this._getEndpoints(this._options),\n        protocol\n      );\n      connection.binaryType = 'arraybuffer';\n      connection.on('open', () => resolve(connection));\n      connection.on('error', reject);\n      connection.on('message', this._dispatchMessage.bind(this));\n      /**\n       * 网络连接断开\n       * @event Realtime#disconnect\n       */\n      /**\n       * 计划在一段时间后尝试重新连接\n       * @event Realtime#schedule\n       * @param {Number} attempt 尝试重连的次数\n       * @param {Number} delay 延迟的毫秒数\n       */\n      /**\n       * 正在尝试重新连接\n       * @event Realtime#retry\n       * @param {Number} attempt 尝试重连的次数\n       */\n      /**\n       * 网络连接恢复正常\n       * @event Realtime#reconnect\n       */\n\n      /**\n       * 客户端连接断开\n       * @event IMClient#disconnect\n       * @since 3.2.0\n       */\n      /**\n       * 计划在一段时间后尝试重新连接\n       * @event IMClient#schedule\n       * @param {Number} attempt 尝试重连的次数\n       * @param {Number} delay 延迟的毫秒数\n       * @since 3.2.0\n       */\n      /**\n       * 正在尝试重新连接\n       * @event IMClient#retry\n       * @param {Number} attempt 尝试重连的次数\n       * @since 3.2.0\n       */\n\n      // event proxy\n      ['disconnect', 'reconnect', 'retry', 'schedule'].forEach(\n        event => connection.on(event, (...payload) => {\n          debug(`${event} event emitted.`, ...payload);\n          this.emit(event, ...payload);\n          if (event !== 'reconnect') {\n            Object.values(this._clients).forEach((client) => {\n              client.emit(event, ...payload);\n            });\n          }\n        })\n      );\n      // override handleClose\n      connection.handleClose = function handleClose(event) {\n        // CAUTION: non-standard API, provided by core-js\n        const isFatal = Array.some([\n          ErrorCode.APP_NOT_AVAILABLE,\n          ErrorCode.INVALID_LOGIN,\n          ErrorCode.INVALID_ORIGIN,\n        ], errorCode => errorCode === event.code);\n        if (isFatal) {\n          // in these cases, SDK should throw.\n          this.throw(createError(event));\n        } else {\n          // reconnect\n          this.disconnect();\n        }\n      };\n      internal(this).connection = connection;\n    });\n\n    return this._openPromise;\n  }\n\n  _getEndpoints(options) {\n    return Promise.resolve(\n      this._cache.get('endpoints') ||\n      this\n        .constructor\n        ._fetchEndpointsInfo(options)\n        .then(\n          tap(info => this._cache.set('endpoints', info, info.ttl * 1000))\n        )\n    ).then((info) => {\n      debug('endpoint info:', info);\n      return [info.server, info.secondary];\n    });\n  }\n\n  static _fetchPushRouter({ appId, region }) {\n    debug('fetch router');\n    switch (region) {\n      case 'cn': {\n        const cachedPushRouter = pushRouterCache.get(appId);\n        if (cachedPushRouter) {\n          return Promise.resolve(cachedPushRouter);\n        }\n        return axios\n          .get('https://app-router.leancloud.cn/1/route', {\n            params: {\n              appId,\n            },\n            timeout: 20000,\n          })\n          .then(\n            res => res.data\n          )\n          .then(tap(debug))\n          .then(\n            (route) => {\n              const pushRouter = route.push_router_server;\n              if (!pushRouter) {\n                throw new Error('push router not exists');\n              }\n              let ttl = route.ttl;\n              if (typeof ttl !== 'number') {\n                ttl = 3600;\n              }\n              pushRouterCache.set(appId, pushRouter, ttl * 1000);\n              return pushRouter;\n            }\n          )\n          .catch(() => 'router-g0-push.leancloud.cn');\n      }\n      case 'us':\n        return Promise.resolve('router-a0-push.leancloud.cn');\n      default:\n        throw new Error(`Region [${region}] is not supported.`);\n    }\n  }\n\n  static _fetchEndpointsInfo({ appId, region, ssl, server }) {\n    debug('fetch endpoint info');\n    return this._fetchPushRouter({ appId, region })\n      .then(tap(debug))\n      .then(router =>\n        axios.get(`https://${router}/v1/route`, {\n          params: {\n            appId,\n            secure: ssl,\n            server,\n            _t: Date.now(),\n          },\n          timeout: 20000,\n        }).then(\n          res => res.data\n        ).then(tap(debug))\n    );\n  }\n\n  _close() {\n    if (this._openPromise) {\n      this._openPromise.then(connection => connection.close());\n    }\n    delete this._openPromise;\n  }\n\n  /**\n   * 手动进行重连。\n   * SDK 在网络出现异常时会自动按照一定的时间间隔尝试重连，调用该方法会立即尝试重连并重置重连尝试计数器。\n   * 只能在 `schedule` 事件之后，`retry` 事件之前调用，如果当前网络正常或者正在进行重连，调用该方法会抛异常。\n   */\n  retry() {\n    const connection = internal(this).connection;\n    if (!connection) {\n      throw new Error('no connection established');\n    }\n    if (connection.cannot('retry')) {\n      throw new Error(\n        `retrying not allowed when not offline. the connection is now ${connection.current}`\n      );\n    }\n    return connection.retry();\n  }\n\n  _register(client) {\n    if (!(client instanceof Client)) {\n      throw new TypeError(`${client} is not a Client`);\n    }\n    if (!client.id) {\n      throw new Error('Client must have an id to be registered');\n    }\n    this._clients[client.id] = client;\n  }\n\n  _deregister(client) {\n    if (!(client instanceof Client)) {\n      throw new TypeError(`${client} is not a Client`);\n    }\n    if (!client.id) {\n      throw new Error('Client must have an id to be deregistered');\n    }\n    delete this._clients[client.id];\n    if (Object.getOwnPropertyNames(this._clients).length === 0) {\n      this._close();\n    }\n  }\n\n  _dispatchMessage(message) {\n    if (message.peerId !== null) {\n      const targetClient = this._clients[message.peerId];\n      if (targetClient) {\n        return Promise.resolve(targetClient)\n          .then(client => client._dispatchMessage(message))\n          .catch(debug);\n      }\n      return debug(\n        '[WARN] Unexpected message received without any live client match',\n        trim(message)\n      );\n    }\n    return debug('[WARN] Unexpected message received without peerId', trim(message));\n  }\n\n  /**\n   * 创建一个即时通讯客户端，多次创建相同 id 的客户端会返回同一个实例\n   * @param  {String} [id] 客户端 id，如果不指定，服务端会随机生成一个\n   * @param  {Object} [clientOptions] 详细参数 @see {@link IMClient}\n   * @param  {String} [tag] 客户端类型标记，以支持单点登录功能\n   * @return {Promise.<IMClient>}\n   */\n  createIMClient(id, clientOptions, tag) {\n    const idIsString = typeof id === 'string';\n    if (idIsString && this._clients[id] !== undefined) {\n      return Promise.resolve(this._clients[id]);\n    }\n    const promise = this._open().then((connection) => {\n      const client = new IMClient(id, clientOptions, connection, {\n        _messageParser: this._messageParser,\n        _plugins: this._plugins,\n      });\n      connection.on('reconnect', () =>\n        client._open(this._options.appId, tag, this._id, true)\n          /**\n           * 客户端连接恢复正常，该事件通常在 {@link Realtime#event:reconnect} 之后发生\n           * @event IMClient#reconnect\n           * @since 3.2.0\n           */\n          /**\n           * 客户端重新登录发生错误（网络连接已恢复，但重新登录错误）\n           * @event IMClient#reconnecterror\n           * @since 3.2.0\n           */\n          .then(\n            () => client.emit('reconnect'),\n            error => client.emit('reconnecterror', error)\n          )\n      );\n      internal(client)._eventemitter.on('close', () => this._deregister(client), this);\n      return client._open(this._options.appId, tag, this._id)\n        .then(() => {\n          this._register(client);\n          return client;\n        });\n    });\n    if (idIsString) {\n      this._clients[id] = promise;\n    }\n    return promise;\n  }\n\n  /**\n   * 注册消息类\n   *\n   * 在接收消息、查询消息时，会按照消息类注册顺序的逆序依次尝试解析消息内容\n   *\n   * @param  {Function | Function[]} messageClass 消息类，需要实现 {@link AVMessage} 接口，\n   * 建议继承自 {@link TypedMessage}\n   * @throws {TypeError} 如果 messageClass 没有实现 {@link AVMessage} 接口则抛出异常\n   */\n  register(messageClass) {\n    return ensureArray(messageClass).map(this._messageParser.register.bind(this._messageParser));\n  }\n\n  /**\n   * 为 Conversation 定义一个新属性\n   * @since 3.2.0\n   * @static\n   * @param {String} prop 属性名\n   * @param {Object} [descriptor] 属性的描述符，参见 {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor#Description getOwnPropertyDescriptor#Description - MDN}，默认为该属性名对应的 Conversation 自定义属性的 getter/setter\n   * @returns void\n   * @example\n   *\n   * conversation.get('type');\n   * conversation.set('type', 1);\n   *\n   * // equals to\n   * Realtime.defineConversationProperty('type');\n   * conversation.type;\n   * conversation.type = 1;\n   */\n  static defineConversationProperty(prop, descriptor = {\n    get() { return this.get(prop); },\n    set(value) { this.set(prop, value); },\n  }) {\n    Object.defineProperty(Conversation.prototype, prop, descriptor);\n  }\n}\n","/** @module leancloud-realtime */\nimport Realtime from './realtime';\nimport Message, { MessageStatus } from './messages/message';\nimport TypedMessage from './messages/typed-message';\nimport TextMessage from './messages/text-message';\nimport {\n  messageType,\n  messageField,\n  IE10Compatible,\n} from './messages/helpers';\n\n/**\n * 消息状态枚举\n * @enum {Symbol}\n * @since 3.3.0\n * @memberof module:leancloud-realtime\n */\nconst OnlineStatus = {\n  /** 在线 */\n  ONLINE: Symbol('online'),\n  /** 离线 */\n  OFFLINE: Symbol('offline'),\n};\n\nexport {\n  /**\n   * @see Realtime\n   */\n  Realtime,\n  /**\n   * @see Message\n   */\n  Message,\n  /**\n   * @see TypedMessage\n   */\n  TypedMessage,\n  /**\n   * @see TextMessage\n   */\n  TextMessage,\n  /**\n   * decorator，定义消息类的类型常量\n   * @function\n   * @param {Number} type 自定义类型请使用正整数\n   * @example @messageType(1)\n   * class CustomMessage extends TypedMessage {}\n   *\n   * // 不支持 decorator 的情况下可以这样使用\n   * class CustomMessage extends TypedMessage {\n   *   //...\n   * }\n   * messageType(1)(CustomMessage);\n   */\n  messageType,\n  /**\n   * decorator，定义消息类的自定义字段\n   * @function\n   * @param {String[]} fields 自定义字段\n   * @example @messageField(['foo'])\n   * class CustomMessage extends TypedMessage {\n   *   constructor(foo) {\n   *     super();\n   *     this.foo = foo;\n   *   }\n   * }\n   *\n   * // 不支持 decorator 的情况下可以这样使用\n   * class CustomMessage extends TypedMessage {\n   *   constructor(foo) {\n   *     super();\n   *     this.foo = foo;\n   *   }\n   *   //...\n   * }\n   * messageField(['foo'])(CustomMessage);\n   */\n  messageField,\n  IE10Compatible,\n  MessageStatus,\n  OnlineStatus,\n};\n\nexport {\n  /**\n   * 错误码，详见 {@link https://leancloud.cn/docs/realtime_v2.html#云端错误码说明}\n   * @enum {Number}\n   * @since 3.3.0\n   */\n  ErrorCode,\n} from './error';\n"],"names":["EXPIRED","debug","d","Expirable","value","ttl","_value","expiredAt","Date","now","expired","Cache","name","_map","get","key","cache","set","tryAll","promiseConstructors","promise","length","catch","slice","tap","interceptor","decodeDate","date","__type","iso","keyRemap","keymap","obj","reduce","newObj","newKey","isIE10","global","navigator","userAgent","indexOf","getStaticProperty","klass","property","__proto__","undefined","union","a","b","difference","filter","bSet","has","x","map","internal","object","removeNull","isPlainObject","prop","hasOwnProperty","call","trim","JSON","parse","message","ensureArray","target","Array","isArray","setValue","segs","split","lastSeg","pop","currentTarget","forEach","seg","HEARTBEAT_TIME","TIMEOUT_TIME","DEFAULT_RETRY_STRATEGY","Math","min","pow","attempt","requireConnected","descriptor","requireConnectedWrapper","is","currentState","current","warn","Error","args","WebSocketPlus","getUrls","protocol","WebSocket","_getUrls","resolve","_protocol","init","_createWs","then","open","throw","error","bind","__postponeTimers","_postponeTimers","wsUrls","urls","reject","url","ws","binaryType","onopen","onerror","onclose","_ws","_handleClose","onmessage","_handleMessage","_destroyWs","close","emit","onconnected","_startConnectionKeeper","onleaveconnected","_stopConnectionKeeper","onbeforedisconnect","ondisconnect","onreconnect","onoffline","event","from","to","delay","__scheduledRetry","setTimeout","retry","onretry","reconnect","fail","_ping","ping","_clearTimers","_heartbeatTimer","setInterval","_timeoutTimer","disconnect","addListener","addEventListener","removeListener","removeEventListener","code","reason","isFinished","handleClose","send","data","handleMessage","EventEmitter","StateMachine","create","prototype","ErrorCode","result","Number","createError","errorMessage","appCode","detail","err","module","exports","require","newBuilder","build","messages","push_server","JsonObjectMessage","SessionCommand","DirectCommand","AckCommand","ConvCommand","LogsCommand","ReadTuple","ReadCommand","GenericCommand","CommandType","OpType","COMMAND_TIMEOUT","Connection","getUrl","format","version","protocolString","_protocalFormat","_commands","_serialId","command","waitingForRespond","serialId","i","toBase64","toBuffer","toArrayBuffer","TypeError","msg","decode","e","cmd","console","checkType","param","constructor","middleware","_pluginName","applyDecorators","decorators","decorator","applyMiddlewares","middlewares","previousPromise","Client","id","options","connection","props","_dispatchMessage","ConversationQuery","_encode","toJSON","RegExp","source","_quote","s","replace","_calculateFlag","prev","Boolean","client","_client","_where","_extraOptions","_addCondition","condition","json","_skip","skip","_limit","limit","_order","sort","containsMembers","peerIds","containsAll","withMembers","includeSelf","peerIdsSet","add","sizeEqualTo","size","equalTo","lessThan","lessThanOrEqualTo","greaterThan","greaterThanOrEqualTo","notEqualTo","containedIn","values","notContainsIn","contains","subString","startsWith","prefix","endsWith","suffix","matches","regex","_modifiers","ignoreCase","multiline","ascending","addAscending","descending","addDescending","withLastMessagesRefreshed","enabled","withLastMessages","compact","find","_executeQuery","_validateSignature","signatureResult","signature","timestamp","nonce","signatureFactory","params","MessageStatus","rMessageStatus","NONE","SENDING","SENT","DELIVERED","FAILED","Message","content","uuid","v4","_setStatus","setNeedReceipt","needReceipt","setTransient","transient","status","_status","validate","IMClient","_messageParser","_conversationCache","_ackMessageBuffer","_eventemitter","on","payload","_debug","_plugins","onIMClientCreate","conv","_dispatchConvMessage","direct","_dispatchDirectMessage","session","_dispatchSessionMessage","unread","_dispatchUnreadMessage","rcp","_dispatchRcpMessage","presence","_dispatchPresenceMessage","sessionMessage","op","closed","SESSION_CONFLICT","convs","unreadMessage","all","getConversation","cid","conversation","toNumber","lastMessageAt","unreadMessagesCount","mid","rcpMessage","conversationId","messageId","deliveredAt","t","_handleReceipt","convMessage","initBy","m","joined","members","left","members_joined","members_left","presenceMessage","sessionPeerIds","OnlineStatus","originalMessage","directMessage","fromPeerId","messageProps","lastMessage","_sendAck","push","_doSendAckThrottled","throttle","_doSendAck","_connection","convAckMessages","timestamps","apply","max","_send","peerId","_open","appId","tag","deviceId","isReconnect","VERSION","sessionToken","runSignatureFactory","resCommand","token","st","tokenTTL","stTtl","SESSION_TOKEN_EXPIRED","clientIds","onlineSessionPeerIds","noCache","cachedConversation","getQuery","conversations","query","queryJSON","where","results","commandString","_parseConversationFromRawData","fetchedConversation","_reset","rawData","lastMessageFrom","lastMessageId","lastMessageTimestamp","Conversation","createConversation","attributes","unique","properties","attr","startCommandJson","conversationSignatureFactory","cdate","markAllAsRead","ids","getTime","creator","createdAt","updatedAt","mutedMembers","system","muted","_attributes","messagesWaitingForReciept","onConversationCreate","setAttributes","assign","setAttribute","setName","currentAttributes","pendingAttributes","pendingKeys","re","childKeys","test","k","parentKey","cloneDeep","save","isEmpty","udate","fetch","mute","unmute","count","remove","join","quit","sendPromise","ackMessage","uid","queryMessages","beforeMessageId","beforeTime","afterMessageId","afterTime","conditions","tt","logsMessage","logs","log","msgId","createMessagesIterator","prevMessages","markAsRead","updateOnlineStatusPolicy","pub","sub","_createdAt","_updatedAt","_lastMessageAt","tryParseJson","fn","wrapper","applyPlugins","beforeMessageParse","decoratedJson","afterMessageParse","MessageParser","plugins","_messageClasses","register","messageClass","unshift","Klass","contentCopy","valid","messageType","type","TYPE","_lctype","_getType","messageField","fields","some","originalCustomFields","_customFields","concat","IE10Compatible","TypedMessage","_","setText","text","_lctext","getText","_lcattrs","getAttributes","_getCustomFields","field","customFields","TextMessage","pushRouterCache","Realtime","_options","_id","_cache","_clients","plugin","hook","onRealtimeCreate","messageClasses","_openPromise","noBinary","pushOfflineMessages","_getEndpoints","isFatal","APP_NOT_AVAILABLE","INVALID_LOGIN","INVALID_ORIGIN","errorCode","_fetchEndpointsInfo","info","server","secondary","_fetchPushRouter","region","cachedPushRouter","axios","res","route","pushRouter","push_router_server","ssl","router","_close","cannot","_register","_deregister","targetClient","createIMClient","clientOptions","idIsString","defineConversationProperty"],"mappings":"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"}